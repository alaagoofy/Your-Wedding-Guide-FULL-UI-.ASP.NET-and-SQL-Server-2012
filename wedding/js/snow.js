function randomRange(a, b) { return Math.random() * (b - a) + a } function initialiseSnow() { container = document.createElement("div"), container.setAttribute("id", "snowContainer"), $(container).insertBefore("#imageMapWrapper"), camera = new THREE.PerspectiveCamera(75, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 1e4), camera.position.z = 1e3, scene = new THREE.Scene, scene.add(camera), renderer = new THREE.CanvasRenderer, renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT); for (var a = new THREE.ParticleBasicMaterial({ map: new THREE.Texture(particleImage) }), b = 0; 300 > b; b++) particle = new Particle3D(a), particle.position.x = 2e3 * Math.random() - 1e3, particle.position.y = 2e3 * Math.random() - 1e3, particle.position.z = 2e3 * Math.random() - 1e3, particle.scale.x = particle.scale.y = 1, scene.add(particle), particles.push(particle); camera.lookAt(scene.position), container.appendChild(renderer.domElement), setInterval(loop, 20), $(window).resize(resizeSnow) } function loop() { for (var i = 0; i < particles.length; i++) { var particle = particles[i]; with (particle.updatePhysics(), particle.position) -1e3 > y && (y += 2e3), x > 1e3 ? x -= 2e3 : -1e3 > x && (x += 2e3), z > 1e3 ? z -= 2e3 : -1e3 > z && (z += 2e3) } renderer.render(scene, camera) } function resizeSnow() { THREEx.WindowResize(renderer, camera) } !function (a) { function b(b, c) { function d() { return k.update(), f(), k } function e() { var a = t.toLowerCase(); q.obj.css(s, u / o.ratio), n.obj.css(s, -u), w.start = q.obj.offset()[s], customSize = 0 === p[c.axis] ? 0 : p[c.axis] - 40, customThumbSize = 0 === q[c.axis] ? 0 : q[c.axis] - 40, o.obj.css(a, p[c.axis]), p.obj.css(a, p[c.axis]), q.obj.css(a, customThumbSize) } function f() { x ? m.obj[0].ontouchstart = function (a) { 1 === a.touches.length && (g(a.touches[0]), a.stopPropagation()) } : (q.obj.bind("mousedown", g), p.obj.bind("mouseup", i)), c.scroll && window.addEventListener ? (l[0].addEventListener("DOMMouseScroll", h, !1), l[0].addEventListener("mousewheel", h, !1)) : c.scroll && (l[0].onmousewheel = h) } function g(b) { a("body").addClass("noSelect"); var c = parseInt(q.obj.css(s), 10); w.start = r ? b.pageX : b.pageY, v.start = "auto" == c ? 0 : c, x ? (document.ontouchmove = function (a) { a.preventDefault(), i(a.touches[0]) }, document.ontouchend = j) : (a(document).bind("mousemove", i), a(document).bind("mouseup", j), q.obj.bind("mouseup", j)) } function h(b) { if (n.ratio < 1) { var d = b || window.event, e = d.wheelDelta ? d.wheelDelta / 120 : -d.detail / 3; u -= e * c.wheel, u = Math.min(n[c.axis] - m[c.axis], Math.max(0, u)), q.obj.css(s, u / o.ratio), n.obj.css(s, -u), (c.lockscroll || u !== n[c.axis] - m[c.axis] && 0 !== u) && (d = a.event.fix(d), d.preventDefault()) } } function i(a) { n.ratio < 1 && (v.now = c.invertscroll && x ? Math.min(p[c.axis] - q[c.axis], Math.max(0, v.start + (w.start - (r ? a.pageX : a.pageY)))) : Math.min(p[c.axis] - q[c.axis], Math.max(0, v.start + ((r ? a.pageX : a.pageY) - w.start))), u = v.now * o.ratio, n.obj.css(s, -u), q.obj.css(s, v.now)) } function j() { a("body").removeClass("noSelect"), a(document).unbind("mousemove", i), a(document).unbind("mouseup", j), q.obj.unbind("mouseup", j), document.ontouchmove = document.ontouchend = null } var k = this, l = b, m = { obj: a(".viewport", b) }, n = { obj: a(".overview", b) }, o = { obj: a(".scrollbar", b) }, p = { obj: a(".track", o.obj) }, q = { obj: a(".thumb", o.obj) }, r = "x" === c.axis, s = r ? "left" : "top", t = r ? "Width" : "Height", u = 0, v = { start: 0, now: 0 }, w = {}, x = "ontouchstart" in document.documentElement; return this.update = function (a) { m[c.axis] = m.obj[0]["offset" + t], n[c.axis] = n.obj[0]["scroll" + t], n.ratio = m[c.axis] / n[c.axis], o.obj.toggleClass("disable", n.ratio >= 1), p[c.axis] = "auto" === c.size ? m[c.axis] : c.size, q[c.axis] = Math.min(p[c.axis], Math.max(0, "auto" === c.sizethumb ? p[c.axis] * n.ratio : c.sizethumb)), o.ratio = "auto" === c.sizethumb ? n[c.axis] / p[c.axis] : (n[c.axis] - m[c.axis]) / (p[c.axis] - q[c.axis]), u = "relative" === a && n.ratio <= 1 ? Math.min(n[c.axis] - m[c.axis], Math.max(0, u)) : 0, u = "bottom" === a && n.ratio <= 1 ? n[c.axis] - m[c.axis] : isNaN(parseInt(a, 10)) ? u : parseInt(a, 10), e() }, d() } a.tiny = a.tiny || {}, a.tiny.scrollbar = { options: { axis: "y", wheel: 40, scroll: !0, lockscroll: !0, size: "auto", sizethumb: "auto", invertscroll: !1 } }, a.fn.tinyscrollbar = function (c) { var d = a.extend({}, a.tiny.scrollbar.options, c); return this.each(function () { a(this).data("tsb", new b(a(this), d)) }), this }, a.fn.tinyscrollbar_update = function (b) { return a(this).data("tsb").update(b) } }(jQuery), function (a) { a.extend(a.fn, { validate: function (b) { if (!this.length) return b && b.debug && window.console && console.warn("Nothing selected, can't validate, returning nothing."), void 0; var c = a.data(this[0], "validator"); return c ? c : (this.attr("novalidate", "novalidate"), c = new a.validator(b, this[0]), a.data(this[0], "validator", c), c.settings.onsubmit && (this.validateDelegate(":submit", "click", function (b) { c.settings.submitHandler && (c.submitButton = b.target), a(b.target).hasClass("cancel") && (c.cancelSubmit = !0), void 0 !== a(b.target).attr("formnovalidate") && (c.cancelSubmit = !0) }), this.submit(function (b) { function d() { var d; return c.settings.submitHandler ? (c.submitButton && (d = a("<input type='hidden'/>").attr("name", c.submitButton.name).val(a(c.submitButton).val()).appendTo(c.currentForm)), c.settings.submitHandler.call(c, c.currentForm, b), c.submitButton && d.remove(), !1) : !0 } return c.settings.debug && b.preventDefault(), c.cancelSubmit ? (c.cancelSubmit = !1, d()) : c.form() ? c.pendingRequest ? (c.formSubmitted = !0, !1) : d() : (c.focusInvalid(), !1) })), c) }, valid: function () { if (a(this[0]).is("form")) return this.validate().form(); var b = !0, c = a(this[0].form).validate(); return this.each(function () { b = b && c.element(this) }), b }, removeAttrs: function (b) { var c = {}, d = this; return a.each(b.split(/\s/), function (a, b) { c[b] = d.attr(b), d.removeAttr(b) }), c }, rules: function (b, c) { var d = this[0]; if (b) { var e = a.data(d.form, "validator").settings, f = e.rules, g = a.validator.staticRules(d); switch (b) { case "add": a.extend(g, a.validator.normalizeRule(c)), delete g.messages, f[d.name] = g, c.messages && (e.messages[d.name] = a.extend(e.messages[d.name], c.messages)); break; case "remove": if (!c) return delete f[d.name], g; var h = {}; return a.each(c.split(/\s/), function (a, b) { h[b] = g[b], delete g[b] }), h } } var i = a.validator.normalizeRules(a.extend({}, a.validator.classRules(d), a.validator.attributeRules(d), a.validator.dataRules(d), a.validator.staticRules(d)), d); if (i.required) { var j = i.required; delete i.required, i = a.extend({ required: j }, i) } return i } }), a.extend(a.expr[":"], { blank: function (b) { return !a.trim("" + a(b).val()) }, filled: function (b) { return !!a.trim("" + a(b).val()) }, unchecked: function (b) { return !a(b).prop("checked") } }), a.validator = function (b, c) { this.settings = a.extend(!0, {}, a.validator.defaults, b), this.currentForm = c, this.init() }, a.validator.format = function (b, c) { return 1 === arguments.length ? function () { var c = a.makeArray(arguments); return c.unshift(b), a.validator.format.apply(this, c) } : (arguments.length > 2 && c.constructor !== Array && (c = a.makeArray(arguments).slice(1)), c.constructor !== Array && (c = [c]), a.each(c, function (a, c) { b = b.replace(RegExp("\\{" + a + "\\}", "g"), function () { return c }) }), b) }, a.extend(a.validator, { defaults: { messages: {}, groups: {}, rules: {}, errorClass: "error", validClass: "valid", errorElement: "label", focusInvalid: !0, errorContainer: a([]), errorLabelContainer: a([]), onsubmit: !0, ignore: ":hidden", ignoreTitle: !1, onfocusin: function (a) { this.lastActive = a, this.settings.focusCleanup && !this.blockFocusCleanup && (this.settings.unhighlight && this.settings.unhighlight.call(this, a, this.settings.errorClass, this.settings.validClass), this.addWrapper(this.errorsFor(a)).hide()) }, onfocusout: function (a) { this.checkable(a) || !(a.name in this.submitted) && this.optional(a) || this.element(a) }, onkeyup: function (a, b) { (9 !== b.which || "" !== this.elementValue(a)) && (a.name in this.submitted || a === this.lastElement) && this.element(a) }, onclick: function (a) { a.name in this.submitted ? this.element(a) : a.parentNode.name in this.submitted && this.element(a.parentNode) }, highlight: function (b, c, d) { "radio" === b.type ? this.findByName(b.name).addClass(c).removeClass(d) : a(b).addClass(c).removeClass(d) }, unhighlight: function (b, c, d) { "radio" === b.type ? this.findByName(b.name).removeClass(c).addClass(d) : a(b).removeClass(c).addClass(d) } }, setDefaults: function (b) { a.extend(a.validator.defaults, b) }, messages: { required: "This field is required.", remote: "Please fix this field.", email: "Please enter a valid email address.", url: "Please enter a valid URL.", date: "Please enter a valid date.", dateISO: "Please enter a valid date (ISO).", number: "Please enter a valid number.", digits: "Please enter only digits.", creditcard: "Please enter a valid credit card number.", equalTo: "Please enter the same value again.", maxlength: a.validator.format("Please enter no more than {0} characters."), minlength: a.validator.format("Please enter at least {0} characters."), rangelength: a.validator.format("Please enter a value between {0} and {1} characters long."), range: a.validator.format("Please enter a value between {0} and {1}."), max: a.validator.format("Please enter a value less than or equal to {0}."), min: a.validator.format("Please enter a value greater than or equal to {0}.") }, autoCreateRanges: !1, prototype: { init: function () { function b(b) { var c = a.data(this[0].form, "validator"), d = "on" + b.type.replace(/^validate/, ""); c.settings[d] && c.settings[d].call(c, this[0], b) } this.labelContainer = a(this.settings.errorLabelContainer), this.errorContext = this.labelContainer.length && this.labelContainer || a(this.currentForm), this.containers = a(this.settings.errorContainer).add(this.settings.errorLabelContainer), this.submitted = {}, this.valueCache = {}, this.pendingRequest = 0, this.pending = {}, this.invalid = {}, this.reset(); var c = this.groups = {}; a.each(this.settings.groups, function (b, d) { "string" == typeof d && (d = d.split(/\s/)), a.each(d, function (a, d) { c[d] = b }) }); var d = this.settings.rules; a.each(d, function (b, c) { d[b] = a.validator.normalizeRule(c) }), a(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ", "focusin focusout keyup", b).validateDelegate("[type='radio'], [type='checkbox'], select, option", "click", b), this.settings.invalidHandler && a(this.currentForm).bind("invalid-form.validate", this.settings.invalidHandler) }, form: function () { return this.checkForm(), a.extend(this.submitted, this.errorMap), this.invalid = a.extend({}, this.errorMap), this.valid() || a(this.currentForm).triggerHandler("invalid-form", [this]), this.showErrors(), this.valid() }, checkForm: function () { this.prepareForm(); for (var a = 0, b = this.currentElements = this.elements() ; b[a]; a++) this.check(b[a]); return this.valid() }, element: function (b) { b = this.validationTargetFor(this.clean(b)), this.lastElement = b, this.prepareElement(b), this.currentElements = a(b); var c = this.check(b) !== !1; return c ? delete this.invalid[b.name] : this.invalid[b.name] = !0, this.numberOfInvalids() || (this.toHide = this.toHide.add(this.containers)), this.showErrors(), c }, showErrors: function (b) { if (b) { a.extend(this.errorMap, b), this.errorList = []; for (var c in b) this.errorList.push({ message: b[c], element: this.findByName(c)[0] }); this.successList = a.grep(this.successList, function (a) { return !(a.name in b) }) } this.settings.showErrors ? this.settings.showErrors.call(this, this.errorMap, this.errorList) : this.defaultShowErrors() }, resetForm: function () { a.fn.resetForm && a(this.currentForm).resetForm(), this.submitted = {}, this.lastElement = null, this.prepareForm(), this.hideErrors(), this.elements().removeClass(this.settings.errorClass).removeData("previousValue") }, numberOfInvalids: function () { return this.objectLength(this.invalid) }, objectLength: function (a) { var b = 0; for (var c in a) b++; return b }, hideErrors: function () { this.addWrapper(this.toHide).hide() }, valid: function () { return 0 === this.size() }, size: function () { return this.errorList.length }, focusInvalid: function () { if (this.settings.focusInvalid) try { a(this.findLastActive() || this.errorList.length && this.errorList[0].element || []).filter(":visible").focus().trigger("focusin") } catch (b) { } }, findLastActive: function () { var b = this.lastActive; return b && 1 === a.grep(this.errorList, function (a) { return a.element.name === b.name }).length && b }, elements: function () { var b = this, c = {}; return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function () { return !this.name && b.settings.debug && window.console && console.error("%o has no name assigned", this), this.name in c || !b.objectLength(a(this).rules()) ? !1 : (c[this.name] = !0, !0) }) }, clean: function (b) { return a(b)[0] }, errors: function () { var b = this.settings.errorClass.replace(" ", "."); return a(this.settings.errorElement + "." + b, this.errorContext) }, reset: function () { this.successList = [], this.errorList = [], this.errorMap = {}, this.toShow = a([]), this.toHide = a([]), this.currentElements = a([]) }, prepareForm: function () { this.reset(), this.toHide = this.errors().add(this.containers) }, prepareElement: function (a) { this.reset(), this.toHide = this.errorsFor(a) }, elementValue: function (b) { var c = a(b).attr("type"), d = a(b).val(); return "radio" === c || "checkbox" === c ? a("input[name='" + a(b).attr("name") + "']:checked").val() : "string" == typeof d ? d.replace(/\r/g, "") : d }, check: function (b) { b = this.validationTargetFor(this.clean(b)); var c, d = a(b).rules(), e = !1, f = this.elementValue(b); for (var g in d) { var h = { method: g, parameters: d[g] }; try { if (c = a.validator.methods[g].call(this, f, b, h.parameters), "dependency-mismatch" === c) { e = !0; continue } if (e = !1, "pending" === c) return this.toHide = this.toHide.not(this.errorsFor(b)), void 0; if (!c) return this.formatAndAdd(b, h), !1 } catch (i) { throw this.settings.debug && window.console && console.log("Exception occurred when checking element " + b.id + ", check the '" + h.method + "' method.", i), i } } return e ? void 0 : (this.objectLength(d) && this.successList.push(b), !0) }, customDataMessage: function (b, c) { return a(b).data("msg-" + c.toLowerCase()) || b.attributes && a(b).attr("data-msg-" + c.toLowerCase()) }, customMessage: function (a, b) { var c = this.settings.messages[a]; return c && (c.constructor === String ? c : c[b]) }, findDefined: function () { for (var a = 0; arguments.length > a; a++) if (void 0 !== arguments[a]) return arguments[a]; return void 0 }, defaultMessage: function (b, c) { return this.findDefined(this.customMessage(b.name, c), this.customDataMessage(b, c), !this.settings.ignoreTitle && b.title || void 0, a.validator.messages[c], "<strong>Warning: No message defined for " + b.name + "</strong>") }, formatAndAdd: function (b, c) { var d = this.defaultMessage(b, c.method), e = /\$?\{(\d+)\}/g; "function" == typeof d ? d = d.call(this, c.parameters, b) : e.test(d) && (d = a.validator.format(d.replace(e, "{$1}"), c.parameters)), this.errorList.push({ message: d, element: b }), this.errorMap[b.name] = d, this.submitted[b.name] = d }, addWrapper: function (a) { return this.settings.wrapper && (a = a.add(a.parent(this.settings.wrapper))), a }, defaultShowErrors: function () { var a, b; for (a = 0; this.errorList[a]; a++) { var c = this.errorList[a]; this.settings.highlight && this.settings.highlight.call(this, c.element, this.settings.errorClass, this.settings.validClass), this.showLabel(c.element, c.message) } if (this.errorList.length && (this.toShow = this.toShow.add(this.containers)), this.settings.success) for (a = 0; this.successList[a]; a++) this.showLabel(this.successList[a]); if (this.settings.unhighlight) for (a = 0, b = this.validElements() ; b[a]; a++) this.settings.unhighlight.call(this, b[a], this.settings.errorClass, this.settings.validClass); this.toHide = this.toHide.not(this.toShow), this.hideErrors(), this.addWrapper(this.toShow).show() }, validElements: function () { return this.currentElements.not(this.invalidElements()) }, invalidElements: function () { return a(this.errorList).map(function () { return this.element }) }, showLabel: function (b, c) { var d = this.errorsFor(b); d.length ? (d.removeClass(this.settings.validClass).addClass(this.settings.errorClass), d.html(c)) : (d = a("<" + this.settings.errorElement + ">").attr("for", this.idOrName(b)).addClass(this.settings.errorClass).html(c || ""), this.settings.wrapper && (d = d.hide().show().wrap("<" + this.settings.wrapper + "/>").parent()), this.labelContainer.append(d).length || (this.settings.errorPlacement ? this.settings.errorPlacement(d, a(b)) : d.insertAfter(b))), !c && this.settings.success && (d.text(""), "string" == typeof this.settings.success ? d.addClass(this.settings.success) : this.settings.success(d, b)), this.toShow = this.toShow.add(d) }, errorsFor: function (b) { var c = this.idOrName(b); return this.errors().filter(function () { return a(this).attr("for") === c }) }, idOrName: function (a) { return this.groups[a.name] || (this.checkable(a) ? a.name : a.id || a.name) }, validationTargetFor: function (a) { return this.checkable(a) && (a = this.findByName(a.name).not(this.settings.ignore)[0]), a }, checkable: function (a) { return /radio|checkbox/i.test(a.type) }, findByName: function (b) { return a(this.currentForm).find("[name='" + b + "']") }, getLength: function (b, c) { switch (c.nodeName.toLowerCase()) { case "select": return a("option:selected", c).length; case "input": if (this.checkable(c)) return this.findByName(c.name).filter(":checked").length } return b.length }, depend: function (a, b) { return this.dependTypes[typeof a] ? this.dependTypes[typeof a](a, b) : !0 }, dependTypes: { "boolean": function (a) { return a }, string: function (b, c) { return !!a(b, c.form).length }, "function": function (a, b) { return a(b) } }, optional: function (b) { var c = this.elementValue(b); return !a.validator.methods.required.call(this, c, b) && "dependency-mismatch" }, startRequest: function (a) { this.pending[a.name] || (this.pendingRequest++, this.pending[a.name] = !0) }, stopRequest: function (b, c) { this.pendingRequest--, 0 > this.pendingRequest && (this.pendingRequest = 0), delete this.pending[b.name], c && 0 === this.pendingRequest && this.formSubmitted && this.form() ? (a(this.currentForm).submit(), this.formSubmitted = !1) : !c && 0 === this.pendingRequest && this.formSubmitted && (a(this.currentForm).triggerHandler("invalid-form", [this]), this.formSubmitted = !1) }, previousValue: function (b) { return a.data(b, "previousValue") || a.data(b, "previousValue", { old: null, valid: !0, message: this.defaultMessage(b, "remote") }) } }, classRuleSettings: { required: { required: !0 }, email: { email: !0 }, url: { url: !0 }, date: { date: !0 }, dateISO: { dateISO: !0 }, number: { number: !0 }, digits: { digits: !0 }, creditcard: { creditcard: !0 } }, addClassRules: function (b, c) { b.constructor === String ? this.classRuleSettings[b] = c : a.extend(this.classRuleSettings, b) }, classRules: function (b) { var c = {}, d = a(b).attr("class"); return d && a.each(d.split(" "), function () { this in a.validator.classRuleSettings && a.extend(c, a.validator.classRuleSettings[this]) }), c }, attributeRules: function (b) { var c = {}, d = a(b), e = d[0].getAttribute("type"); for (var f in a.validator.methods) { var g; "required" === f ? (g = d.get(0).getAttribute(f), "" === g && (g = !0), g = !!g) : g = d.attr(f), /min|max/.test(f) && (null === e || /number|range|text/.test(e)) && (g = Number(g)), g ? c[f] = g : e === f && "range" !== e && (c[f] = !0) } return c.maxlength && /-1|2147483647|524288/.test(c.maxlength) && delete c.maxlength, c }, dataRules: function (b) { var c, d, e = {}, f = a(b); for (c in a.validator.methods) d = f.data("rule-" + c.toLowerCase()), void 0 !== d && (e[c] = d); return e }, staticRules: function (b) { var c = {}, d = a.data(b.form, "validator"); return d.settings.rules && (c = a.validator.normalizeRule(d.settings.rules[b.name]) || {}), c }, normalizeRules: function (b, c) { return a.each(b, function (d, e) { if (e === !1) return delete b[d], void 0; if (e.param || e.depends) { var f = !0; switch (typeof e.depends) { case "string": f = !!a(e.depends, c.form).length; break; case "function": f = e.depends.call(c, c) } f ? b[d] = void 0 !== e.param ? e.param : !0 : delete b[d] } }), a.each(b, function (d, e) { b[d] = a.isFunction(e) ? e(c) : e }), a.each(["minlength", "maxlength"], function () { b[this] && (b[this] = Number(b[this])) }), a.each(["rangelength", "range"], function () { var c; b[this] && (a.isArray(b[this]) ? b[this] = [Number(b[this][0]), Number(b[this][1])] : "string" == typeof b[this] && (c = b[this].split(/[\s,]+/), b[this] = [Number(c[0]), Number(c[1])])) }), a.validator.autoCreateRanges && (b.min && b.max && (b.range = [b.min, b.max], delete b.min, delete b.max), b.minlength && b.maxlength && (b.rangelength = [b.minlength, b.maxlength], delete b.minlength, delete b.maxlength)), b }, normalizeRule: function (b) { if ("string" == typeof b) { var c = {}; a.each(b.split(/\s/), function () { c[this] = !0 }), b = c } return b }, addMethod: function (b, c, d) { a.validator.methods[b] = c, a.validator.messages[b] = void 0 !== d ? d : a.validator.messages[b], 3 > c.length && a.validator.addClassRules(b, a.validator.normalizeRule(b)) }, methods: { required: function (b, c, d) { if (!this.depend(d, c)) return "dependency-mismatch"; if ("select" === c.nodeName.toLowerCase()) { var e = a(c).val(); return e && e.length > 0 } return this.checkable(c) ? this.getLength(b, c) > 0 : a.trim(b).length > 0 }, email: function (a, b) { return this.optional(b) || /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a) }, url: function (a, b) { return this.optional(b) || /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a) }, date: function (a, b) { return this.optional(b) || !/Invalid|NaN/.test("" + new Date(a)) }, dateISO: function (a, b) { return this.optional(b) || /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a) }, number: function (a, b) { return this.optional(b) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a) }, digits: function (a, b) { return this.optional(b) || /^\d+$/.test(a) }, creditcard: function (a, b) { if (this.optional(b)) return "dependency-mismatch"; if (/[^0-9 \-]+/.test(a)) return !1; var c = 0, d = 0, e = !1; a = a.replace(/\D/g, ""); for (var f = a.length - 1; f >= 0; f--) { var g = a.charAt(f); d = parseInt(g, 10), e && (d *= 2) > 9 && (d -= 9), c += d, e = !e } return 0 === c % 10 }, minlength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(a.trim(b), c); return this.optional(c) || e >= d }, maxlength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(a.trim(b), c); return this.optional(c) || d >= e }, rangelength: function (b, c, d) { var e = a.isArray(b) ? b.length : this.getLength(a.trim(b), c); return this.optional(c) || e >= d[0] && d[1] >= e }, min: function (a, b, c) { return this.optional(b) || a >= c }, max: function (a, b, c) { return this.optional(b) || c >= a }, range: function (a, b, c) { return this.optional(b) || a >= c[0] && c[1] >= a }, equalTo: function (b, c, d) { var e = a(d); return this.settings.onfocusout && e.unbind(".validate-equalTo").bind("blur.validate-equalTo", function () { a(c).valid() }), b === e.val() }, remote: function (b, c, d) { if (this.optional(c)) return "dependency-mismatch"; var e = this.previousValue(c); if (this.settings.messages[c.name] || (this.settings.messages[c.name] = {}), e.originalMessage = this.settings.messages[c.name].remote, this.settings.messages[c.name].remote = e.message, d = "string" == typeof d && { url: d } || d, e.old === b) return e.valid; e.old = b; var f = this; this.startRequest(c); var g = {}; return g[c.name] = b, a.ajax(a.extend(!0, { url: d, mode: "abort", port: "validate" + c.name, dataType: "json", data: g, success: function (d) { f.settings.messages[c.name].remote = e.originalMessage; var g = d === !0 || "true" === d; if (g) { var h = f.formSubmitted; f.prepareElement(c), f.formSubmitted = h, f.successList.push(c), delete f.invalid[c.name], f.showErrors() } else { var i = {}, j = d || f.defaultMessage(c, "remote"); i[c.name] = e.message = a.isFunction(j) ? j(b) : j, f.invalid[c.name] = !0, f.showErrors(i) } e.valid = g, f.stopRequest(c, g) } }, d)), "pending" } } }), a.format = a.validator.format }(jQuery), function (a) { var b = {}; if (a.ajaxPrefilter) a.ajaxPrefilter(function (a, c, d) { var e = a.port; "abort" === a.mode && (b[e] && b[e].abort(), b[e] = d) }); else { var c = a.ajax; a.ajax = function (d) { var e = ("mode" in d ? d : a.ajaxSettings).mode, f = ("port" in d ? d : a.ajaxSettings).port; return "abort" === e ? (b[f] && b[f].abort(), b[f] = c.apply(this, arguments), b[f]) : c.apply(this, arguments) } } }(jQuery), function (a) { a.extend(a.fn, { validateDelegate: function (b, c, d) { return this.bind(c, function (c) { var e = a(c.target); return e.is(b) ? d.apply(e, arguments) : void 0 }) } }) }(jQuery), function (a, b, c, d) {
    var e = c("html"), f = c(a), g = c(b), h = c.fancybox = function () { h.open.apply(this, arguments) }, i = navigator.userAgent.match(/msie/i), j = null, k = b.createTouch !== d, l = function (a) { return a && a.hasOwnProperty && a instanceof c }, m = function (a) { return a && "string" === c.type(a) }, n = function (a) { return m(a) && 0 < a.indexOf("%") }, o = function (a, b) { var c = parseInt(a, 10) || 0; return b && n(a) && (c *= h.getViewport()[b] / 100), Math.ceil(c) }, p = function (a, b) { return o(a, b) + "px" }; c.extend(h, {
        version: "2.1.5", defaults: { padding: 15, margin: 20, width: 800, height: 600, minWidth: 100, minHeight: 100, maxWidth: 9999, maxHeight: 9999, pixelRatio: 1, autoSize: !0, autoHeight: !1, autoWidth: !1, autoResize: !0, autoCenter: !k, fitToView: !0, aspectRatio: !1, topRatio: .5, leftRatio: .5, scrolling: "auto", wrapCSS: "", arrows: !0, closeBtn: !0, closeClick: !1, nextClick: !1, mouseWheel: !0, autoPlay: !1, playSpeed: 3e3, preload: 3, modal: !1, loop: !0, ajax: { dataType: "html", headers: { "X-fancyBox": !0 } }, iframe: { scrolling: "auto", preload: !0 }, swf: { wmode: "transparent", allowfullscreen: "true", allowscriptaccess: "always" }, keys: { next: { 13: "left", 34: "up", 39: "left", 40: "up" }, prev: { 8: "right", 33: "down", 37: "right", 38: "down" }, close: [27], play: [32], toggle: [70] }, direction: { next: "left", prev: "right" }, scrollOutside: !0, index: 0, type: null, href: null, content: null, title: null, tpl: { wrap: '<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>', image: '<img class="fancybox-image" src="{href}" alt="" />', iframe: '<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen' + (i ? ' allowtransparency="true"' : "") + "></iframe>", error: '<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>', closeBtn: '<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>', next: '<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>', prev: '<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>' }, openEffect: "fade", openSpeed: 250, openEasing: "swing", openOpacity: !0, openMethod: "zoomIn", closeEffect: "fade", closeSpeed: 250, closeEasing: "swing", closeOpacity: !0, closeMethod: "zoomOut", nextEffect: "elastic", nextSpeed: 250, nextEasing: "swing", nextMethod: "changeIn", prevEffect: "elastic", prevSpeed: 250, prevEasing: "swing", prevMethod: "changeOut", helpers: { overlay: !0, title: !0 }, onCancel: c.noop, beforeLoad: c.noop, afterLoad: c.noop, beforeShow: c.noop, afterShow: c.noop, beforeChange: c.noop, beforeClose: c.noop, afterClose: c.noop }, group: {}, opts: {}, previous: null, coming: null, current: null, isActive: !1, isOpen: !1, isOpened: !1, wrap: null, skin: null, outer: null, inner: null, player: { timer: null, isActive: !1 }, ajaxLoad: null, imgPreload: null, transitions: {}, helpers: {}, open: function (a, b) { return a && (c.isPlainObject(b) || (b = {}), !1 !== h.close(!0)) ? (c.isArray(a) || (a = l(a) ? c(a).get() : [a]), c.each(a, function (e, f) { var g, i, j, k, n, o = {}; "object" === c.type(f) && (f.nodeType && (f = c(f)), l(f) ? (o = { href: f.data("fancybox-href") || f.attr("href"), title: f.data("fancybox-title") || f.attr("title"), isDom: !0, element: f }, c.metadata && c.extend(!0, o, f.metadata())) : o = f), g = b.href || o.href || (m(f) ? f : null), i = b.title !== d ? b.title : o.title || "", k = (j = b.content || o.content) ? "html" : b.type || o.type, !k && o.isDom && (k = f.data("fancybox-type"), k || (k = (k = f.prop("class").match(/fancybox\.(\w+)/)) ? k[1] : null)), m(g) && (k || (h.isImage(g) ? k = "image" : h.isSWF(g) ? k = "swf" : "#" === g.charAt(0) ? k = "inline" : m(f) && (k = "html", j = f)), "ajax" === k && (n = g.split(/\s+/, 2), g = n.shift(), n = n.shift())), j || ("inline" === k ? g ? j = c(m(g) ? g.replace(/.*(?=#[^\s]+$)/, "") : g) : o.isDom && (j = f) : "html" === k ? j = g : !k && !g && o.isDom && (k = "inline", j = f)), c.extend(o, { href: g, type: k, content: j, title: i, selector: n }), a[e] = o }), h.opts = c.extend(!0, {}, h.defaults, b), b.keys !== d && (h.opts.keys = b.keys ? c.extend({}, h.defaults.keys, b.keys) : !1), h.group = a, h._start(h.opts.index)) : void 0 }, cancel: function () { var a = h.coming; a && !1 !== h.trigger("onCancel") && (h.hideLoading(), h.ajaxLoad && h.ajaxLoad.abort(), h.ajaxLoad = null, h.imgPreload && (h.imgPreload.onload = h.imgPreload.onerror = null), a.wrap && a.wrap.stop(!0, !0).trigger("onReset").remove(), h.coming = null, h.current || h._afterZoomOut(a)) }, close: function (a) { h.cancel(), !1 !== h.trigger("beforeClose") && (h.unbindEvents(), h.isActive && (h.isOpen && !0 !== a ? (h.isOpen = h.isOpened = !1, h.isClosing = !0, c(".fancybox-item, .fancybox-nav").remove(), h.wrap.stop(!0, !0).removeClass("fancybox-opened"), h.transitions[h.current.closeMethod]()) : (c(".fancybox-wrap").stop(!0).trigger("onReset").remove(), h._afterZoomOut()))) }, play: function (a) { var b = function () { clearTimeout(h.player.timer) }, c = function () { b(), h.current && h.player.isActive && (h.player.timer = setTimeout(h.next, h.current.playSpeed)) }, d = function () { b(), g.unbind(".player"), h.player.isActive = !1, h.trigger("onPlayEnd") }; !0 === a || !h.player.isActive && !1 !== a ? h.current && (h.current.loop || h.current.index < h.group.length - 1) && (h.player.isActive = !0, g.bind({ "onCancel.player beforeClose.player": d, "onUpdate.player": c, "beforeLoad.player": b }), c(), h.trigger("onPlayStart")) : d() }, next: function (a) { var b = h.current; b && (m(a) || (a = b.direction.next), h.jumpto(b.index + 1, a, "next")) }, prev: function (a) { var b = h.current; b && (m(a) || (a = b.direction.prev), h.jumpto(b.index - 1, a, "prev")) }, jumpto: function (a, b, c) { var e = h.current; e && (a = o(a), h.direction = b || e.direction[a >= e.index ? "next" : "prev"], h.router = c || "jumpto", e.loop && (0 > a && (a = e.group.length + a % e.group.length), a %= e.group.length), e.group[a] !== d && (h.cancel(), h._start(a))) }, reposition: function (a, b) { var d, e = h.current, f = e ? e.wrap : null; f && (d = h._getPosition(b), a && "scroll" === a.type ? (delete d.position, f.stop(!0, !0).animate(d, 200)) : (f.css(d), e.pos = c.extend({}, e.dim, d))) }, update: function (a) { var b = a && a.type, c = !b || "orientationchange" === b; c && (clearTimeout(j), j = null), h.isOpen && !j && (j = setTimeout(function () { var d = h.current; d && !h.isClosing && (h.wrap.removeClass("fancybox-tmp"), (c || "load" === b || "resize" === b && d.autoResize) && h._setDimension(), "scroll" === b && d.canShrink || h.reposition(a), h.trigger("onUpdate"), j = null) }, c && !k ? 0 : 300)) }, toggle: function (a) { h.isOpen && (h.current.fitToView = "boolean" === c.type(a) ? a : !h.current.fitToView, k && (h.wrap.removeAttr("style").addClass("fancybox-tmp"), h.trigger("onUpdate")), h.update()) }, hideLoading: function () { g.unbind(".loading"), c("#fancybox-loading").remove() }, showLoading: function () { var a, b; h.hideLoading(), a = c('<div id="fancybox-loading"><div></div></div>').click(h.cancel).appendTo("body"), g.bind("keydown.loading", function (a) { 27 === (a.which || a.keyCode) && (a.preventDefault(), h.cancel()) }), h.defaults.fixed || (b = h.getViewport(), a.css({ position: "absolute", top: .5 * b.h + b.y, left: .5 * b.w + b.x })) }, getViewport: function () { var b = h.current && h.current.locked || !1, c = { x: f.scrollLeft(), y: f.scrollTop() }; return b ? (c.w = b[0].clientWidth, c.h = b[0].clientHeight) : (c.w = k && a.innerWidth ? a.innerWidth : f.width(), c.h = k && a.innerHeight ? a.innerHeight : f.height()), c }, unbindEvents: function () { h.wrap && l(h.wrap) && h.wrap.unbind(".fb"), g.unbind(".fb"), f.unbind(".fb") }, bindEvents: function () {
            var a, b = h.current; b && (f.bind("orientationchange.fb" + (k ? "" : " resize.fb") + (b.autoCenter && !b.locked ? " scroll.fb" : ""), h.update), (a = b.keys) && g.bind("keydown.fb", function (e) {
                var f = e.which || e.keyCode, g = e.target || e.srcElement;
                return 27 === f && h.coming ? !1 : (!(e.ctrlKey || e.altKey || e.shiftKey || e.metaKey || g && (g.type || c(g).is("[contenteditable]")) || !c.each(a, function (a, g) { return 1 < b.group.length && g[f] !== d ? (h[a](g[f]), e.preventDefault(), !1) : -1 < c.inArray(f, g) ? (h[a](), e.preventDefault(), !1) : void 0 })), void 0)
            }), c.fn.mousewheel && b.mouseWheel && h.wrap.bind("mousewheel.fb", function (a, d, e, f) { for (var g = c(a.target || null), i = !1; g.length && !i && !g.is(".fancybox-skin") && !g.is(".fancybox-wrap") ;) i = g[0] && !(g[0].style.overflow && "hidden" === g[0].style.overflow) && (g[0].clientWidth && g[0].scrollWidth > g[0].clientWidth || g[0].clientHeight && g[0].scrollHeight > g[0].clientHeight), g = c(g).parent(); 0 !== d && !i && 1 < h.group.length && !b.canShrink && (f > 0 || e > 0 ? h.prev(f > 0 ? "down" : "left") : (0 > f || 0 > e) && h.next(0 > f ? "up" : "right"), a.preventDefault()) }))
        }, trigger: function (a, b) { var d, e = b || h.coming || h.current; if (e) { if (c.isFunction(e[a]) && (d = e[a].apply(e, Array.prototype.slice.call(arguments, 1))), !1 === d) return !1; e.helpers && c.each(e.helpers, function (b, d) { d && h.helpers[b] && c.isFunction(h.helpers[b][a]) && h.helpers[b][a](c.extend(!0, {}, h.helpers[b].defaults, d), e) }), g.trigger(a) } }, isImage: function (a) { return m(a) && a.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i) }, isSWF: function (a) { return m(a) && a.match(/\.(swf)((\?|#).*)?$/i) }, _start: function (a) { var b, d, e = {}; if (a = o(a), b = h.group[a] || null, !b) return !1; if (e = c.extend(!0, {}, h.opts, b), b = e.margin, d = e.padding, "number" === c.type(b) && (e.margin = [b, b, b, b]), "number" === c.type(d) && (e.padding = [d, d, d, d]), e.modal && c.extend(!0, e, { closeBtn: !1, closeClick: !1, nextClick: !1, arrows: !1, mouseWheel: !1, keys: null, helpers: { overlay: { closeClick: !1 } } }), e.autoSize && (e.autoWidth = e.autoHeight = !0), "auto" === e.width && (e.autoWidth = !0), "auto" === e.height && (e.autoHeight = !0), e.group = h.group, e.index = a, h.coming = e, !1 === h.trigger("beforeLoad")) h.coming = null; else { if (d = e.type, b = e.href, !d) return h.coming = null, h.current && h.router && "jumpto" !== h.router ? (h.current.index = a, h[h.router](h.direction)) : !1; if (h.isActive = !0, ("image" === d || "swf" === d) && (e.autoHeight = e.autoWidth = !1, e.scrolling = "visible"), "image" === d && (e.aspectRatio = !0), "iframe" === d && k && (e.scrolling = "scroll"), e.wrap = c(e.tpl.wrap).addClass("fancybox-" + (k ? "mobile" : "desktop") + " fancybox-type-" + d + " fancybox-tmp " + e.wrapCSS).appendTo(e.parent || "body"), c.extend(e, { skin: c(".fancybox-skin", e.wrap), outer: c(".fancybox-outer", e.wrap), inner: c(".fancybox-inner", e.wrap) }), c.each(["Top", "Right", "Bottom", "Left"], function (a, b) { e.skin.css("padding" + b, p(e.padding[a])) }), h.trigger("onReady"), "inline" === d || "html" === d) { if (!e.content || !e.content.length) return h._error("content") } else if (!b) return h._error("href"); "image" === d ? h._loadImage() : "ajax" === d ? h._loadAjax() : "iframe" === d ? h._loadIframe() : h._afterLoad() } }, _error: function (a) { c.extend(h.coming, { type: "html", autoWidth: !0, autoHeight: !0, minWidth: 0, minHeight: 0, scrolling: "no", hasError: a, content: h.coming.tpl.error }), h._afterLoad() }, _loadImage: function () { var a = h.imgPreload = new Image; a.onload = function () { this.onload = this.onerror = null, h.coming.width = this.width / h.opts.pixelRatio, h.coming.height = this.height / h.opts.pixelRatio, h._afterLoad() }, a.onerror = function () { this.onload = this.onerror = null, h._error("image") }, a.src = h.coming.href, !0 !== a.complete && h.showLoading() }, _loadAjax: function () { var a = h.coming; h.showLoading(), h.ajaxLoad = c.ajax(c.extend({}, a.ajax, { url: a.href, error: function (a, b) { h.coming && "abort" !== b ? h._error("ajax", a) : h.hideLoading() }, success: function (b, c) { "success" === c && (a.content = b, h._afterLoad()) } })) }, _loadIframe: function () { var a = h.coming, b = c(a.tpl.iframe.replace(/\{rnd\}/g, (new Date).getTime())).attr("scrolling", k ? "auto" : a.iframe.scrolling).attr("src", a.href); c(a.wrap).bind("onReset", function () { try { c(this).find("iframe").hide().attr("src", "//about:blank").end().empty() } catch (a) { } }), a.iframe.preload && (h.showLoading(), b.one("load", function () { c(this).data("ready", 1), k || c(this).bind("load.fb", h.update), c(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(), h._afterLoad() })), a.content = b.appendTo(a.inner), a.iframe.preload || h._afterLoad() }, _preloadImages: function () { var a, b, c = h.group, d = h.current, e = c.length, f = d.preload ? Math.min(d.preload, e - 1) : 0; for (b = 1; f >= b; b += 1) a = c[(d.index + b) % e], "image" === a.type && a.href && ((new Image).src = a.href) }, _afterLoad: function () { var a, b, d, e, f, g = h.coming, i = h.current; if (h.hideLoading(), g && !1 !== h.isActive) if (!1 === h.trigger("afterLoad", g, i)) g.wrap.stop(!0).trigger("onReset").remove(), h.coming = null; else { switch (i && (h.trigger("beforeChange", i), i.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()), h.unbindEvents(), a = g.content, b = g.type, d = g.scrolling, c.extend(h, { wrap: g.wrap, skin: g.skin, outer: g.outer, inner: g.inner, current: g, previous: i }), e = g.href, b) { case "inline": case "ajax": case "html": g.selector ? a = c("<div>").html(a).find(g.selector) : l(a) && (a.data("fancybox-placeholder") || a.data("fancybox-placeholder", c('<div class="fancybox-placeholder"></div>').insertAfter(a).hide()), a = a.show().detach(), g.wrap.bind("onReset", function () { c(this).find(a).length && a.hide().replaceAll(a.data("fancybox-placeholder")).data("fancybox-placeholder", !1) })); break; case "image": a = g.tpl.image.replace("{href}", e); break; case "swf": a = '<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="' + e + '"></param>', f = "", c.each(g.swf, function (b, c) { a += '<param name="' + b + '" value="' + c + '"></param>', f += " " + b + '="' + c + '"' }), a += '<embed src="' + e + '" type="application/x-shockwave-flash" width="100%" height="100%"' + f + "></embed></object>" } (!l(a) || !a.parent().is(g.inner)) && g.inner.append(a), h.trigger("beforeShow"), g.inner.css("overflow", "yes" === d ? "scroll" : "no" === d ? "hidden" : d), h._setDimension(), h.reposition(), h.isOpen = !1, h.coming = null, h.bindEvents(), h.isOpened ? i.prevMethod && h.transitions[i.prevMethod]() : c(".fancybox-wrap").not(g.wrap).stop(!0).trigger("onReset").remove(), h.transitions[h.isOpened ? g.nextMethod : g.openMethod](), h._preloadImages() } }, _setDimension: function () { var a, b, d, e, f, g, i, j, k, l = h.getViewport(), m = 0, q = !1, r = !1, q = h.wrap, s = h.skin, t = h.inner, u = h.current, r = u.width, v = u.height, w = u.minWidth, x = u.minHeight, y = u.maxWidth, z = u.maxHeight, A = u.scrolling, B = u.scrollOutside ? u.scrollbarWidth : 0, C = u.margin, D = o(C[1] + C[3]), E = o(C[0] + C[2]); if (q.add(s).add(t).width("auto").height("auto").removeClass("fancybox-tmp"), C = o(s.outerWidth(!0) - s.width()), a = o(s.outerHeight(!0) - s.height()), b = D + C, d = E + a, e = n(r) ? (l.w - b) * o(r) / 100 : r, f = n(v) ? (l.h - d) * o(v) / 100 : v, "iframe" === u.type) { if (k = u.content, u.autoHeight && 1 === k.data("ready")) try { k[0].contentWindow.document.location && (t.width(e).height(9999), g = k.contents().find("body"), B && g.css("overflow-x", "hidden"), f = g.outerHeight(!0)) } catch (F) { } } else (u.autoWidth || u.autoHeight) && (t.addClass("fancybox-tmp"), u.autoWidth || t.width(e), u.autoHeight || t.height(f), u.autoWidth && (e = t.width()), u.autoHeight && (f = t.height()), t.removeClass("fancybox-tmp")); if (r = o(e), v = o(f), j = e / f, w = o(n(w) ? o(w, "w") - b : w), y = o(n(y) ? o(y, "w") - b : y), x = o(n(x) ? o(x, "h") - d : x), z = o(n(z) ? o(z, "h") - d : z), g = y, i = z, u.fitToView && (y = Math.min(l.w - b, y), z = Math.min(l.h - d, z)), b = l.w - D, E = l.h - E, u.aspectRatio ? (r > y && (r = y, v = o(r / j)), v > z && (v = z, r = o(v * j)), w > r && (r = w, v = o(r / j)), x > v && (v = x, r = o(v * j))) : (r = Math.max(w, Math.min(r, y)), u.autoHeight && "iframe" !== u.type && (t.width(r), v = t.height()), v = Math.max(x, Math.min(v, z))), u.fitToView) if (t.width(r).height(v), q.width(r + C), l = q.width(), D = q.height(), u.aspectRatio) for (; (l > b || D > E) && r > w && v > x && !(19 < m++) ;) v = Math.max(x, Math.min(z, v - 10)), r = o(v * j), w > r && (r = w, v = o(r / j)), r > y && (r = y, v = o(r / j)), t.width(r).height(v), q.width(r + C), l = q.width(), D = q.height(); else r = Math.max(w, Math.min(r, r - (l - b))), v = Math.max(x, Math.min(v, v - (D - E))); B && "auto" === A && f > v && b > r + C + B && (r += B), t.width(r).height(v), q.width(r + C), l = q.width(), D = q.height(), q = (l > b || D > E) && r > w && v > x, r = u.aspectRatio ? g > r && i > v && e > r && f > v : (g > r || i > v) && (e > r || f > v), c.extend(u, { dim: { width: p(l), height: p(D) }, origWidth: e, origHeight: f, canShrink: q, canExpand: r, wPadding: C, hPadding: a, wrapSpace: D - s.outerHeight(!0), skinSpace: s.height() - v }), !k && u.autoHeight && v > x && z > v && !r && t.height("auto") }, _getPosition: function (a) { var b = h.current, c = h.getViewport(), d = b.margin, e = h.wrap.width() + d[1] + d[3], f = h.wrap.height() + d[0] + d[2], d = { position: "absolute", top: d[0], left: d[3] }; return b.autoCenter && b.fixed && !a && f <= c.h && e <= c.w ? d.position = "fixed" : b.locked || (d.top += c.y, d.left += c.x), d.top = p(Math.max(d.top, d.top + (c.h - f) * b.topRatio)), d.left = p(Math.max(d.left, d.left + (c.w - e) * b.leftRatio)), d }, _afterZoomIn: function () { var a = h.current; a && (h.isOpen = h.isOpened = !0, h.wrap.css("overflow", "visible").addClass("fancybox-opened"), h.update(), (a.closeClick || a.nextClick && 1 < h.group.length) && h.inner.css("cursor", "pointer").bind("click.fb", function (b) { !c(b.target).is("a") && !c(b.target).parent().is("a") && (b.preventDefault(), h[a.closeClick ? "close" : "next"]()) }), a.closeBtn && c(a.tpl.closeBtn).appendTo(h.skin).bind("click.fb", function (a) { a.preventDefault(), h.close() }), a.arrows && 1 < h.group.length && ((a.loop || 0 < a.index) && c(a.tpl.prev).appendTo(h.outer).bind("click.fb", h.prev), (a.loop || a.index < h.group.length - 1) && c(a.tpl.next).appendTo(h.outer).bind("click.fb", h.next)), h.trigger("afterShow"), a.loop || a.index !== a.group.length - 1 ? h.opts.autoPlay && !h.player.isActive && (h.opts.autoPlay = !1, h.play()) : h.play(!1)) }, _afterZoomOut: function (a) { a = a || h.current, c(".fancybox-wrap").trigger("onReset").remove(), c.extend(h, { group: {}, opts: {}, router: !1, current: null, isActive: !1, isOpened: !1, isOpen: !1, isClosing: !1, wrap: null, skin: null, outer: null, inner: null }), h.trigger("afterClose", a) }
    }), h.transitions = { getOrigPosition: function () { var a = h.current, b = a.element, c = a.orig, d = {}, e = 50, f = 50, g = a.hPadding, i = a.wPadding, j = h.getViewport(); return !c && a.isDom && b.is(":visible") && (c = b.find("img:first"), c.length || (c = b)), l(c) ? (d = c.offset(), c.is("img") && (e = c.outerWidth(), f = c.outerHeight())) : (d.top = j.y + (j.h - f) * a.topRatio, d.left = j.x + (j.w - e) * a.leftRatio), ("fixed" === h.wrap.css("position") || a.locked) && (d.top -= j.y, d.left -= j.x), d = { top: p(d.top - g * a.topRatio), left: p(d.left - i * a.leftRatio), width: p(e + i), height: p(f + g) } }, step: function (a, b) { var c, d, e = b.prop; d = h.current; var f = d.wrapSpace, g = d.skinSpace; ("width" === e || "height" === e) && (c = b.end === b.start ? 1 : (a - b.start) / (b.end - b.start), h.isClosing && (c = 1 - c), d = "width" === e ? d.wPadding : d.hPadding, d = a - d, h.skin[e](o("width" === e ? d : d - f * c)), h.inner[e](o("width" === e ? d : d - f * c - g * c))) }, zoomIn: function () { var a = h.current, b = a.pos, d = a.openEffect, e = "elastic" === d, f = c.extend({ opacity: 1 }, b); delete f.position, e ? (b = this.getOrigPosition(), a.openOpacity && (b.opacity = .1)) : "fade" === d && (b.opacity = .1), h.wrap.css(b).animate(f, { duration: "none" === d ? 0 : a.openSpeed, easing: a.openEasing, step: e ? this.step : null, complete: h._afterZoomIn }) }, zoomOut: function () { var a = h.current, b = a.closeEffect, c = "elastic" === b, d = { opacity: .1 }; c && (d = this.getOrigPosition(), a.closeOpacity && (d.opacity = .1)), h.wrap.animate(d, { duration: "none" === b ? 0 : a.closeSpeed, easing: a.closeEasing, step: c ? this.step : null, complete: h._afterZoomOut }) }, changeIn: function () { var a, b = h.current, c = b.nextEffect, d = b.pos, e = { opacity: 1 }, f = h.direction; d.opacity = .1, "elastic" === c && (a = "down" === f || "up" === f ? "top" : "left", "down" === f || "right" === f ? (d[a] = p(o(d[a]) - 200), e[a] = "+=200px") : (d[a] = p(o(d[a]) + 200), e[a] = "-=200px")), "none" === c ? h._afterZoomIn() : h.wrap.css(d).animate(e, { duration: b.nextSpeed, easing: b.nextEasing, complete: h._afterZoomIn }) }, changeOut: function () { var a = h.previous, b = a.prevEffect, d = { opacity: .1 }, e = h.direction; "elastic" === b && (d["down" === e || "up" === e ? "top" : "left"] = ("up" === e || "left" === e ? "-" : "+") + "=200px"), a.wrap.animate(d, { duration: "none" === b ? 0 : a.prevSpeed, easing: a.prevEasing, complete: function () { c(this).trigger("onReset").remove() } }) } }, h.helpers.overlay = { defaults: { closeClick: !0, speedOut: 200, showEarly: !0, css: {}, locked: !k, fixed: !0 }, overlay: null, fixed: !1, el: c("html"), create: function (a) { a = c.extend({}, this.defaults, a), this.overlay && this.close(), this.overlay = c('<div class="fancybox-overlay"></div>').appendTo(h.coming ? h.coming.parent : a.parent), this.fixed = !1, a.fixed && h.defaults.fixed && (this.overlay.addClass("fancybox-overlay-fixed"), this.fixed = !0) }, open: function (a) { var b = this; a = c.extend({}, this.defaults, a), this.overlay ? this.overlay.unbind(".overlay").width("auto").height("auto") : this.create(a), this.fixed || (f.bind("resize.overlay", c.proxy(this.update, this)), this.update()), a.closeClick && this.overlay.bind("click.overlay", function (a) { return c(a.target).hasClass("fancybox-overlay") ? (h.isActive ? h.close() : b.close(), !1) : void 0 }), this.overlay.css(a.css).show() }, close: function () { var a, b; f.unbind("resize.overlay"), this.el.hasClass("fancybox-lock") && (c(".fancybox-margin").removeClass("fancybox-margin"), a = f.scrollTop(), b = f.scrollLeft(), this.el.removeClass("fancybox-lock"), f.scrollTop(a).scrollLeft(b)), c(".fancybox-overlay").remove().hide(), c.extend(this, { overlay: null, fixed: !1 }) }, update: function () { var a, c = "100%"; this.overlay.width(c).height("100%"), i ? (a = Math.max(b.documentElement.offsetWidth, b.body.offsetWidth), g.width() > a && (c = g.width())) : g.width() > f.width() && (c = g.width()), this.overlay.width(c).height(g.height()) }, onReady: function (a, b) { var d = this.overlay; c(".fancybox-overlay").stop(!0, !0), d || this.create(a), a.locked && this.fixed && b.fixed && (d || (this.margin = g.height() > f.height() ? c("html").css("margin-right").replace("px", "") : !1), b.locked = this.overlay.append(b.wrap), b.fixed = !1), !0 === a.showEarly && this.beforeShow.apply(this, arguments) }, beforeShow: function (a, b) { var d, e; b.locked && (!1 !== this.margin && (c("*").filter(function () { return "fixed" === c(this).css("position") && !c(this).hasClass("fancybox-overlay") && !c(this).hasClass("fancybox-wrap") }).addClass("fancybox-margin"), this.el.addClass("fancybox-margin")), d = f.scrollTop(), e = f.scrollLeft(), this.el.addClass("fancybox-lock"), f.scrollTop(d).scrollLeft(e)), this.open(a) }, onUpdate: function () { this.fixed || this.update() }, afterClose: function (a) { this.overlay && !h.coming && this.overlay.fadeOut(a.speedOut, c.proxy(this.close, this)) } }, h.helpers.title = { defaults: { type: "float", position: "bottom" }, beforeShow: function (a) { var b = h.current, d = b.title, e = a.type; if (c.isFunction(d) && (d = d.call(b.element, b)), m(d) && "" !== c.trim(d)) { switch (b = c('<div class="fancybox-title fancybox-title-' + e + '-wrap">' + d + "</div>"), e) { case "inside": e = h.skin; break; case "outside": e = h.wrap; break; case "over": e = h.inner; break; default: e = h.skin, b.appendTo("body"), i && b.width(b.width()), b.wrapInner('<span class="child"></span>'), h.current.margin[2] += Math.abs(o(b.css("margin-bottom"))) } b["top" === a.position ? "prependTo" : "appendTo"](e) } } }, c.fn.fancybox = function (a) { var b, d = c(this), e = this.selector || "", f = function (f) { var g, i, j = c(this).blur(), k = b; !(f.ctrlKey || f.altKey || f.shiftKey || f.metaKey || j.is(".fancybox-wrap") || (g = a.groupAttr || "data-fancybox-group", i = j.attr(g), i || (g = "rel", i = j.get(0)[g]), i && "" !== i && "nofollow" !== i && (j = e.length ? c(e) : d, j = j.filter("[" + g + '="' + i + '"]'), k = j.index(this)), a.index = k, !1 === h.open(j, a) || !f.preventDefault())) }; return a = a || {}, b = a.index || 0, e && !1 !== a.live ? g.undelegate(e, "click.fb-start").delegate(e + ":not('.fancybox-item, .fancybox-nav')", "click.fb-start", f) : d.unbind("click.fb-start").bind("click.fb-start", f), this.filter("[data-fancybox-start=1]").trigger("click"), this }, g.ready(function () { var b, f; if (c.scrollbarWidth === d && (c.scrollbarWidth = function () { var a = c('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"), b = a.children(), b = b.innerWidth() - b.height(99).innerWidth(); return a.remove(), b }), c.support.fixedPosition === d) { b = c.support, f = c('<div style="position:fixed;top:20px;"></div>').appendTo("body"); var g = 20 === f[0].offsetTop || 15 === f[0].offsetTop; f.remove(), b.fixedPosition = g } c.extend(h.defaults, { scrollbarWidth: c.scrollbarWidth(), fixed: c.support.fixedPosition, parent: c("body") }), b = c(a).width(), e.addClass("fancybox-lock-test"), f = c(a).width(), e.removeClass("fancybox-lock-test"), c("<style type='text/css'>.fancybox-margin{margin-right:" + (f - b) + "px;}</style>").appendTo("head") })
}(window, document, jQuery); var THREE = THREE || {}; self.Int32Array || (self.Int32Array = Array, self.Float32Array = Array), THREE.Color = function (a) { return void 0 !== a && this.setHex(a), this }, THREE.Color.prototype = { constructor: THREE.Color, r: 1, g: 1, b: 1, copy: function (a) { return this.r = a.r, this.g = a.g, this.b = a.b, this }, copyGammaToLinear: function (a) { return this.r = a.r * a.r, this.g = a.g * a.g, this.b = a.b * a.b, this }, copyLinearToGamma: function (a) { return this.r = Math.sqrt(a.r), this.g = Math.sqrt(a.g), this.b = Math.sqrt(a.b), this }, setRGB: function (a, b, c) { return this.r = a, this.g = b, this.b = c, this }, setHSV: function (a, b, c) { var d, e, f; if (0 === c) this.r = this.g = this.b = 0; else switch (d = Math.floor(6 * a), e = 6 * a - d, a = c * (1 - b), f = c * (1 - b * e), b = c * (1 - b * (1 - e)), d) { case 1: this.r = f, this.g = c, this.b = a; break; case 2: this.r = a, this.g = c, this.b = b; break; case 3: this.r = a, this.g = f, this.b = c; break; case 4: this.r = b, this.g = a, this.b = c; break; case 5: this.r = c, this.g = a, this.b = f; break; case 6: case 0: this.r = c, this.g = b, this.b = a } return this }, setHex: function (a) { return a = Math.floor(a), this.r = (a >> 16 & 255) / 255, this.g = (a >> 8 & 255) / 255, this.b = (255 & a) / 255, this }, getHex: function () { return ~~(255 * this.r) << 16 ^ ~~(255 * this.g) << 8 ^ ~~(255 * this.b) }, getContextStyle: function () { return "rgb(" + Math.floor(255 * this.r) + "," + Math.floor(255 * this.g) + "," + Math.floor(255 * this.b) + ")" }, clone: function () { return (new THREE.Color).setRGB(this.r, this.g, this.b) } }, THREE.Vector2 = function (a, b) { this.x = a || 0, this.y = b || 0 }, THREE.Vector2.prototype = { constructor: THREE.Vector2, set: function (a, b) { return this.x = a, this.y = b, this }, copy: function (a) { return this.x = a.x, this.y = a.y, this }, clone: function () { return new THREE.Vector2(this.x, this.y) }, add: function (a, b) { return this.x = a.x + b.x, this.y = a.y + b.y, this }, addSelf: function (a) { return this.x += a.x, this.y += a.y, this }, sub: function (a, b) { return this.x = a.x - b.x, this.y = a.y - b.y, this }, subSelf: function (a) { return this.x -= a.x, this.y -= a.y, this }, multiplyScalar: function (a) { return this.x *= a, this.y *= a, this }, divideScalar: function (a) { return a ? (this.x /= a, this.y /= a) : this.set(0, 0), this }, negate: function () { return this.multiplyScalar(-1) }, dot: function (a) { return this.x * a.x + this.y * a.y }, lengthSq: function () { return this.x * this.x + this.y * this.y }, length: function () { return Math.sqrt(this.lengthSq()) }, normalize: function () { return this.divideScalar(this.length()) }, distanceTo: function (a) { return Math.sqrt(this.distanceToSquared(a)) }, distanceToSquared: function (a) { var b = this.x - a.x, a = this.y - a.y; return b * b + a * a }, setLength: function (a) { return this.normalize().multiplyScalar(a) }, equals: function (a) { return a.x === this.x && a.y === this.y } }, THREE.Vector3 = function (a, b, c) { this.x = a || 0, this.y = b || 0, this.z = c || 0 }, THREE.Vector3.prototype = { constructor: THREE.Vector3, set: function (a, b, c) { return this.x = a, this.y = b, this.z = c, this }, setX: function (a) { return this.x = a, this }, setY: function (a) { return this.y = a, this }, setZ: function (a) { return this.z = a, this }, copy: function (a) { return this.x = a.x, this.y = a.y, this.z = a.z, this }, clone: function () { return new THREE.Vector3(this.x, this.y, this.z) }, add: function (a, b) { return this.x = a.x + b.x, this.y = a.y + b.y, this.z = a.z + b.z, this }, addSelf: function (a) { return this.x += a.x, this.y += a.y, this.z += a.z, this }, addScalar: function (a) { return this.x += a, this.y += a, this.z += a, this }, sub: function (a, b) { return this.x = a.x - b.x, this.y = a.y - b.y, this.z = a.z - b.z, this }, subSelf: function (a) { return this.x -= a.x, this.y -= a.y, this.z -= a.z, this }, multiply: function (a, b) { return this.x = a.x * b.x, this.y = a.y * b.y, this.z = a.z * b.z, this }, multiplySelf: function (a) { return this.x *= a.x, this.y *= a.y, this.z *= a.z, this }, multiplyScalar: function (a) { return this.x *= a, this.y *= a, this.z *= a, this }, divideSelf: function (a) { return this.x /= a.x, this.y /= a.y, this.z /= a.z, this }, divideScalar: function (a) { return a ? (this.x /= a, this.y /= a, this.z /= a) : this.z = this.y = this.x = 0, this }, negate: function () { return this.multiplyScalar(-1) }, dot: function (a) { return this.x * a.x + this.y * a.y + this.z * a.z }, lengthSq: function () { return this.x * this.x + this.y * this.y + this.z * this.z }, length: function () { return Math.sqrt(this.lengthSq()) }, lengthManhattan: function () { return this.x + this.y + this.z }, normalize: function () { return this.divideScalar(this.length()) }, setLength: function (a) { return this.normalize().multiplyScalar(a) }, cross: function (a, b) { return this.x = a.y * b.z - a.z * b.y, this.y = a.z * b.x - a.x * b.z, this.z = a.x * b.y - a.y * b.x, this }, crossSelf: function (a) { var b = this.x, c = this.y, d = this.z; return this.x = c * a.z - d * a.y, this.y = d * a.x - b * a.z, this.z = b * a.y - c * a.x, this }, distanceTo: function (a) { return Math.sqrt(this.distanceToSquared(a)) }, distanceToSquared: function (a) { return (new THREE.Vector3).sub(this, a).lengthSq() }, setPositionFromMatrix: function (a) { this.x = a.n14, this.y = a.n24, this.z = a.n34 }, setRotationFromMatrix: function (a) { var b = Math.cos(this.y); this.y = Math.asin(a.n13), Math.abs(b) > 1e-5 ? (this.x = Math.atan2(-a.n23 / b, a.n33 / b), this.z = Math.atan2(-a.n12 / b, a.n11 / b)) : (this.x = 0, this.z = Math.atan2(a.n21, a.n22)) }, isZero: function () { return this.lengthSq() < 1e-4 } }, THREE.Vector4 = function (a, b, c, d) { this.x = a || 0, this.y = b || 0, this.z = c || 0, this.w = void 0 !== d ? d : 1 }, THREE.Vector4.prototype = { constructor: THREE.Vector4, set: function (a, b, c, d) { return this.x = a, this.y = b, this.z = c, this.w = d, this }, copy: function (a) { this.x = a.x, this.y = a.y, this.z = a.z, this.w = void 0 !== a.w ? a.w : 1 }, clone: function () { return new THREE.Vector4(this.x, this.y, this.z, this.w) }, add: function (a, b) { return this.x = a.x + b.x, this.y = a.y + b.y, this.z = a.z + b.z, this.w = a.w + b.w, this }, addSelf: function (a) { return this.x += a.x, this.y += a.y, this.z += a.z, this.w += a.w, this }, sub: function (a, b) { return this.x = a.x - b.x, this.y = a.y - b.y, this.z = a.z - b.z, this.w = a.w - b.w, this }, subSelf: function (a) { return this.x -= a.x, this.y -= a.y, this.z -= a.z, this.w -= a.w, this }, multiplyScalar: function (a) { return this.x *= a, this.y *= a, this.z *= a, this.w *= a, this }, divideScalar: function (a) { return a ? (this.x /= a, this.y /= a, this.z /= a, this.w /= a) : (this.z = this.y = this.x = 0, this.w = 1), this }, negate: function () { return this.multiplyScalar(-1) }, dot: function (a) { return this.x * a.x + this.y * a.y + this.z * a.z + this.w * a.w }, lengthSq: function () { return this.dot(this) }, length: function () { return Math.sqrt(this.lengthSq()) }, normalize: function () { return this.divideScalar(this.length()) }, setLength: function (a) { return this.normalize().multiplyScalar(a) }, lerpSelf: function (a, b) { return this.x += (a.x - this.x) * b, this.y += (a.y - this.y) * b, this.z += (a.z - this.z) * b, this.w += (a.w - this.w) * b, this } }, THREE.Ray = function (a, b) { function c(a, b, c) { return w.sub(c, a), l = w.dot(b), 0 >= l ? null : (m = x.add(a, y.copy(b).multiplyScalar(l)), n = c.distanceTo(m)) } function d(a, b, c, d) { return w.sub(d, b), x.sub(c, b), y.sub(a, b), o = w.dot(w), p = w.dot(x), q = w.dot(y), r = x.dot(x), s = x.dot(y), t = 1 / (o * r - p * p), u = (r * q - p * s) * t, v = (o * s - p * q) * t, u >= 0 && v >= 0 && 1 > u + v } this.origin = a || new THREE.Vector3, this.direction = b || new THREE.Vector3, this.intersectScene = function (a) { return this.intersectObjects(a.children) }, this.intersectObjects = function (a) { var b, c, d = []; for (b = 0, c = a.length; c > b; b++) Array.prototype.push.apply(d, this.intersectObject(a[b])); return d.sort(function (a, b) { return a.distance - b.distance }), d }; var e = new THREE.Vector3, f = new THREE.Vector3, g = new THREE.Vector3, h = new THREE.Vector3, a = new THREE.Vector3, b = new THREE.Vector3, i = new THREE.Vector3, j = new THREE.Vector3, k = new THREE.Vector3; this.intersectObject = function (l) { for (var m, n = [], o = 0, p = l.children.length; p > o; o++) Array.prototype.push.apply(n, this.intersectObject(l.children[o])); if (l instanceof THREE.Particle) { if (o = c(this.origin, this.direction, l.matrixWorld.getPosition()), null === o || o > l.scale.x) return []; m = { distance: o, point: l.position, face: null, object: l }, n.push(m) } else if (l instanceof THREE.Mesh) { if (o = c(this.origin, this.direction, l.matrixWorld.getPosition()), null === o || o > l.geometry.boundingSphere.radius * Math.max(l.scale.x, Math.max(l.scale.y, l.scale.z))) return n; var q, r, s = l.geometry, t = s.vertices; for (l.matrixRotationWorld.extractRotation(l.matrixWorld), o = 0, p = s.faces.length; p > o; o++) m = s.faces[o], a.copy(this.origin), b.copy(this.direction), r = l.matrixWorld, i = r.multiplyVector3(i.copy(m.centroid)).subSelf(a), q = i.dot(b), 0 >= q || (e = r.multiplyVector3(e.copy(t[m.a].position)), f = r.multiplyVector3(f.copy(t[m.b].position)), g = r.multiplyVector3(g.copy(t[m.c].position)), m instanceof THREE.Face4 && (h = r.multiplyVector3(h.copy(t[m.d].position))), j = l.matrixRotationWorld.multiplyVector3(j.copy(m.normal)), q = b.dot(j), !l.doubleSided && !(l.flipSided ? q > 0 : 0 > q)) || (q = j.dot(i.sub(e, a)) / q, k.add(a, b.multiplyScalar(q)), m instanceof THREE.Face3 ? d(k, e, f, g) && (m = { distance: a.distanceTo(k), point: k.clone(), face: m, object: l }, n.push(m)) : m instanceof THREE.Face4 && (d(k, e, f, h) || d(k, f, g, h)) && (m = { distance: a.distanceTo(k), point: k.clone(), face: m, object: l }, n.push(m))) } return n }; var l, m, n, o, p, q, r, s, t, u, v, w = new THREE.Vector3, x = new THREE.Vector3, y = new THREE.Vector3 }, THREE.Rectangle = function () { function a() { f = d - b, g = e - c } var b, c, d, e, f, g, h = !0; this.getX = function () { return b }, this.getY = function () { return c }, this.getWidth = function () { return f }, this.getHeight = function () { return g }, this.getLeft = function () { return b }, this.getTop = function () { return c }, this.getRight = function () { return d }, this.getBottom = function () { return e }, this.set = function (f, g, i, j) { h = !1, b = f, c = g, d = i, e = j, a() }, this.addPoint = function (f, g) { h ? (h = !1, b = f, c = g, d = f, e = g) : (b = f > b ? b : f, c = g > c ? c : g, d = d > f ? d : f, e = e > g ? e : g), a() }, this.add3Points = function (f, g, i, j, k, l) { h ? (h = !1, b = i > f ? k > f ? f : k : k > i ? i : k, c = j > g ? l > g ? g : l : l > j ? j : l, d = f > i ? f > k ? f : k : i > k ? i : k, e = g > j ? g > l ? g : l : j > l ? j : l) : (b = i > f ? k > f ? b > f ? f : b : b > k ? k : b : k > i ? b > i ? i : b : b > k ? k : b, c = j > g ? l > g ? c > g ? g : c : c > l ? l : c : l > j ? c > j ? j : c : c > l ? l : c, d = f > i ? f > k ? f > d ? f : d : k > d ? k : d : i > k ? i > d ? i : d : k > d ? k : d, e = g > j ? g > l ? g > e ? g : e : l > e ? l : e : j > l ? j > e ? j : e : l > e ? l : e), a() }, this.addRectangle = function (f) { h ? (h = !1, b = f.getLeft(), c = f.getTop(), d = f.getRight(), e = f.getBottom()) : (b = b < f.getLeft() ? b : f.getLeft(), c = c < f.getTop() ? c : f.getTop(), d = d > f.getRight() ? d : f.getRight(), e = e > f.getBottom() ? e : f.getBottom()), a() }, this.inflate = function (f) { b -= f, c -= f, d += f, e += f, a() }, this.minSelf = function (f) { b = b > f.getLeft() ? b : f.getLeft(), c = c > f.getTop() ? c : f.getTop(), d = d < f.getRight() ? d : f.getRight(), e = e < f.getBottom() ? e : f.getBottom(), a() }, this.intersects = function (a) { return Math.min(d, a.getRight()) - Math.max(b, a.getLeft()) >= 0 && Math.min(e, a.getBottom()) - Math.max(c, a.getTop()) >= 0 }, this.empty = function () { h = !0, e = d = c = b = 0, a() }, this.isEmpty = function () { return h } }, THREE.Math = { clamp: function (a, b, c) { return b > a ? b : a > c ? c : a }, clampBottom: function (a, b) { return b > a ? b : a }, mapLinear: function (a, b, c, d, e) { return d + (a - b) * (e - d) / (c - b) }, random16: function () { return (65280 * Math.random() + 255 * Math.random()) / 65535 } }, THREE.Matrix3 = function () { this.m = [] }, THREE.Matrix3.prototype = { constructor: THREE.Matrix3, transpose: function () { var a, b = this.m; return a = b[1], b[1] = b[3], b[3] = a, a = b[2], b[2] = b[6], b[6] = a, a = b[5], b[5] = b[7], b[7] = a, this }, transposeIntoArray: function (a) { var b = this.m; return a[0] = b[0], a[1] = b[3], a[2] = b[6], a[3] = b[1], a[4] = b[4], a[5] = b[7], a[6] = b[2], a[7] = b[5], a[8] = b[8], this } }, THREE.Matrix4 = function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) { this.set(void 0 !== a ? a : 1, b || 0, c || 0, d || 0, e || 0, void 0 !== f ? f : 1, g || 0, h || 0, i || 0, j || 0, void 0 !== k ? k : 1, l || 0, m || 0, n || 0, o || 0, void 0 !== p ? p : 1), this.flat = Array(16), this.m33 = new THREE.Matrix3 }, THREE.Matrix4.prototype = {
    constructor: THREE.Matrix4, set: function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p) { return this.n11 = a, this.n12 = b, this.n13 = c, this.n14 = d, this.n21 = e, this.n22 = f, this.n23 = g, this.n24 = h, this.n31 = i, this.n32 = j, this.n33 = k, this.n34 = l, this.n41 = m, this.n42 = n, this.n43 = o, this.n44 = p, this }, identity: function () { return this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), this }, copy: function (a) { return this.set(a.n11, a.n12, a.n13, a.n14, a.n21, a.n22, a.n23, a.n24, a.n31, a.n32, a.n33, a.n34, a.n41, a.n42, a.n43, a.n44), this }, lookAt: function (a, b, c) { var d = THREE.Matrix4.__v1, e = THREE.Matrix4.__v2, f = THREE.Matrix4.__v3; return f.sub(a, b).normalize(), 0 === f.length() && (f.z = 1), d.cross(c, f).normalize(), 0 === d.length() && (f.x += 1e-4, d.cross(c, f).normalize()), e.cross(f, d).normalize(), this.n11 = d.x, this.n12 = e.x, this.n13 = f.x, this.n21 = d.y, this.n22 = e.y, this.n23 = f.y, this.n31 = d.z, this.n32 = e.z, this.n33 = f.z, this }, multiply: function (a, b) { var c = a.n11, d = a.n12, e = a.n13, f = a.n14, g = a.n21, h = a.n22, i = a.n23, j = a.n24, k = a.n31, l = a.n32, m = a.n33, n = a.n34, o = a.n41, p = a.n42, q = a.n43, r = a.n44, s = b.n11, t = b.n12, u = b.n13, v = b.n14, w = b.n21, x = b.n22, y = b.n23, z = b.n24, A = b.n31, B = b.n32, C = b.n33, D = b.n34, E = b.n41, F = b.n42, G = b.n43, H = b.n44; return this.n11 = c * s + d * w + e * A + f * E, this.n12 = c * t + d * x + e * B + f * F, this.n13 = c * u + d * y + e * C + f * G, this.n14 = c * v + d * z + e * D + f * H, this.n21 = g * s + h * w + i * A + j * E, this.n22 = g * t + h * x + i * B + j * F, this.n23 = g * u + h * y + i * C + j * G, this.n24 = g * v + h * z + i * D + j * H, this.n31 = k * s + l * w + m * A + n * E, this.n32 = k * t + l * x + m * B + n * F, this.n33 = k * u + l * y + m * C + n * G, this.n34 = k * v + l * z + m * D + n * H, this.n41 = o * s + p * w + q * A + r * E, this.n42 = o * t + p * x + q * B + r * F, this.n43 = o * u + p * y + q * C + r * G, this.n44 = o * v + p * z + q * D + r * H, this }, multiplySelf: function (a) { return this.multiply(this, a) }, multiplyToArray: function (a, b, c) { return this.multiply(a, b), c[0] = this.n11, c[1] = this.n21, c[2] = this.n31, c[3] = this.n41, c[4] = this.n12, c[5] = this.n22, c[6] = this.n32, c[7] = this.n42, c[8] = this.n13, c[9] = this.n23, c[10] = this.n33, c[11] = this.n43, c[12] = this.n14, c[13] = this.n24, c[14] = this.n34, c[15] = this.n44, this }, multiplyScalar: function (a) { return this.n11 *= a, this.n12 *= a, this.n13 *= a, this.n14 *= a, this.n21 *= a, this.n22 *= a, this.n23 *= a, this.n24 *= a, this.n31 *= a, this.n32 *= a, this.n33 *= a, this.n34 *= a, this.n41 *= a, this.n42 *= a, this.n43 *= a, this.n44 *= a, this }, multiplyVector3: function (a) { var b = a.x, c = a.y, d = a.z, e = 1 / (this.n41 * b + this.n42 * c + this.n43 * d + this.n44); return a.x = (this.n11 * b + this.n12 * c + this.n13 * d + this.n14) * e, a.y = (this.n21 * b + this.n22 * c + this.n23 * d + this.n24) * e, a.z = (this.n31 * b + this.n32 * c + this.n33 * d + this.n34) * e, a }, multiplyVector4: function (a) { var b = a.x, c = a.y, d = a.z, e = a.w; return a.x = this.n11 * b + this.n12 * c + this.n13 * d + this.n14 * e, a.y = this.n21 * b + this.n22 * c + this.n23 * d + this.n24 * e, a.z = this.n31 * b + this.n32 * c + this.n33 * d + this.n34 * e, a.w = this.n41 * b + this.n42 * c + this.n43 * d + this.n44 * e, a }, rotateAxis: function (a) { var b = a.x, c = a.y, d = a.z; return a.x = b * this.n11 + c * this.n12 + d * this.n13, a.y = b * this.n21 + c * this.n22 + d * this.n23, a.z = b * this.n31 + c * this.n32 + d * this.n33, a.normalize(), a }, crossVector: function (a) { var b = new THREE.Vector4; return b.x = this.n11 * a.x + this.n12 * a.y + this.n13 * a.z + this.n14 * a.w, b.y = this.n21 * a.x + this.n22 * a.y + this.n23 * a.z + this.n24 * a.w, b.z = this.n31 * a.x + this.n32 * a.y + this.n33 * a.z + this.n34 * a.w, b.w = a.w ? this.n41 * a.x + this.n42 * a.y + this.n43 * a.z + this.n44 * a.w : 1, b }, determinant: function () { var a = this.n11, b = this.n12, c = this.n13, d = this.n14, e = this.n21, f = this.n22, g = this.n23, h = this.n24, i = this.n31, j = this.n32, k = this.n33, l = this.n34, m = this.n41, n = this.n42, o = this.n43, p = this.n44; return d * g * j * m - c * h * j * m - d * f * k * m + b * h * k * m + c * f * l * m - b * g * l * m - d * g * i * n + c * h * i * n + d * e * k * n - a * h * k * n - c * e * l * n + a * g * l * n + d * f * i * o - b * h * i * o - d * e * j * o + a * h * j * o + b * e * l * o - a * f * l * o - c * f * i * p + b * g * i * p + c * e * j * p - a * g * j * p - b * e * k * p + a * f * k * p }, transpose: function () { var a; return a = this.n21, this.n21 = this.n12, this.n12 = a, a = this.n31, this.n31 = this.n13, this.n13 = a, a = this.n32, this.n32 = this.n23, this.n23 = a, a = this.n41, this.n41 = this.n14, this.n14 = a, a = this.n42, this.n42 = this.n24, this.n24 = a, a = this.n43, this.n43 = this.n34, this.n43 = a, this }, clone: function () { var a = new THREE.Matrix4; return a.n11 = this.n11, a.n12 = this.n12, a.n13 = this.n13, a.n14 = this.n14, a.n21 = this.n21, a.n22 = this.n22, a.n23 = this.n23, a.n24 = this.n24, a.n31 = this.n31, a.n32 = this.n32, a.n33 = this.n33, a.n34 = this.n34, a.n41 = this.n41, a.n42 = this.n42, a.n43 = this.n43, a.n44 = this.n44, a }, flatten: function () { return this.flat[0] = this.n11, this.flat[1] = this.n21, this.flat[2] = this.n31, this.flat[3] = this.n41, this.flat[4] = this.n12, this.flat[5] = this.n22, this.flat[6] = this.n32, this.flat[7] = this.n42, this.flat[8] = this.n13, this.flat[9] = this.n23, this.flat[10] = this.n33, this.flat[11] = this.n43, this.flat[12] = this.n14, this.flat[13] = this.n24, this.flat[14] = this.n34, this.flat[15] = this.n44, this.flat }, flattenToArray: function (a) { return a[0] = this.n11, a[1] = this.n21, a[2] = this.n31, a[3] = this.n41, a[4] = this.n12, a[5] = this.n22, a[6] = this.n32, a[7] = this.n42, a[8] = this.n13, a[9] = this.n23, a[10] = this.n33, a[11] = this.n43, a[12] = this.n14, a[13] = this.n24, a[14] = this.n34, a[15] = this.n44, a }, flattenToArrayOffset: function (a, b) { return a[b] = this.n11, a[b + 1] = this.n21, a[b + 2] = this.n31, a[b + 3] = this.n41, a[b + 4] = this.n12, a[b + 5] = this.n22, a[b + 6] = this.n32, a[b + 7] = this.n42, a[b + 8] = this.n13, a[b + 9] = this.n23, a[b + 10] = this.n33, a[b + 11] = this.n43, a[b + 12] = this.n14, a[b + 13] = this.n24, a[b + 14] = this.n34, a[b + 15] = this.n44, a }, setTranslation: function (a, b, c) { return this.set(1, 0, 0, a, 0, 1, 0, b, 0, 0, 1, c, 0, 0, 0, 1), this }, setScale: function (a, b, c) { return this.set(a, 0, 0, 0, 0, b, 0, 0, 0, 0, c, 0, 0, 0, 0, 1), this }, setRotationX: function (a) { var b = Math.cos(a), a = Math.sin(a); return this.set(1, 0, 0, 0, 0, b, -a, 0, 0, a, b, 0, 0, 0, 0, 1), this }, setRotationY: function (a) { var b = Math.cos(a), a = Math.sin(a); return this.set(b, 0, a, 0, 0, 1, 0, 0, -a, 0, b, 0, 0, 0, 0, 1), this }, setRotationZ: function (a) {
        var b = Math.cos(a), a = Math.sin(a);
        return this.set(b, -a, 0, 0, a, b, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), this
    }, setRotationAxis: function (a, b) { var c = Math.cos(b), d = Math.sin(b), e = 1 - c, f = a.x, g = a.y, h = a.z, i = e * f, j = e * g; return this.set(i * f + c, i * g - d * h, i * h + d * g, 0, i * g + d * h, j * g + c, j * h - d * f, 0, i * h - d * g, j * h + d * f, e * h * h + c, 0, 0, 0, 0, 1), this }, setPosition: function (a) { return this.n14 = a.x, this.n24 = a.y, this.n34 = a.z, this }, getPosition: function () { return THREE.Matrix4.__v1.set(this.n14, this.n24, this.n34) }, getColumnX: function () { return THREE.Matrix4.__v1.set(this.n11, this.n21, this.n31) }, getColumnY: function () { return THREE.Matrix4.__v1.set(this.n12, this.n22, this.n32) }, getColumnZ: function () { return THREE.Matrix4.__v1.set(this.n13, this.n23, this.n33) }, getInverse: function (a) { var b = a.n11, c = a.n12, d = a.n13, e = a.n14, f = a.n21, g = a.n22, h = a.n23, i = a.n24, j = a.n31, k = a.n32, l = a.n33, m = a.n34, n = a.n41, o = a.n42, p = a.n43, q = a.n44; return this.n11 = h * m * o - i * l * o + i * k * p - g * m * p - h * k * q + g * l * q, this.n12 = e * l * o - d * m * o - e * k * p + c * m * p + d * k * q - c * l * q, this.n13 = d * i * o - e * h * o + e * g * p - c * i * p - d * g * q + c * h * q, this.n14 = e * h * k - d * i * k - e * g * l + c * i * l + d * g * m - c * h * m, this.n21 = i * l * n - h * m * n - i * j * p + f * m * p + h * j * q - f * l * q, this.n22 = d * m * n - e * l * n + e * j * p - b * m * p - d * j * q + b * l * q, this.n23 = e * h * n - d * i * n - e * f * p + b * i * p + d * f * q - b * h * q, this.n24 = d * i * j - e * h * j + e * f * l - b * i * l - d * f * m + b * h * m, this.n31 = g * m * n - i * k * n + i * j * o - f * m * o - g * j * q + f * k * q, this.n32 = e * k * n - c * m * n - e * j * o + b * m * o + c * j * q - b * k * q, this.n33 = d * i * n - e * g * n + e * f * o - b * i * o - c * f * q + b * g * q, this.n34 = e * g * j - c * i * j - e * f * k + b * i * k + c * f * m - b * g * m, this.n41 = h * k * n - g * l * n - h * j * o + f * l * o + g * j * p - f * k * p, this.n42 = c * l * n - d * k * n + d * j * o - b * l * o - c * j * p + b * k * p, this.n43 = d * g * n - c * h * n - d * f * o + b * h * o + c * f * p - b * g * p, this.n44 = c * h * j - d * g * j + d * f * k - b * h * k - c * f * l + b * g * l, this.multiplyScalar(1 / a.determinant()), this }, setRotationFromEuler: function (a, b) { var c = a.x, d = a.y, e = a.z, f = Math.cos(c), c = Math.sin(c), g = Math.cos(d), d = Math.sin(d), h = Math.cos(e), e = Math.sin(e); switch (b) { case "YXZ": var i = g * h, j = g * e, k = d * h, l = d * e; this.n11 = i + l * c, this.n12 = k * c - j, this.n13 = f * d, this.n21 = f * e, this.n22 = f * h, this.n23 = -c, this.n31 = j * c - k, this.n32 = l + i * c, this.n33 = f * g; break; case "ZXY": i = g * h, j = g * e, k = d * h, l = d * e, this.n11 = i - l * c, this.n12 = -f * e, this.n13 = k + j * c, this.n21 = j + k * c, this.n22 = f * h, this.n23 = l - i * c, this.n31 = -f * d, this.n32 = c, this.n33 = f * g; break; case "ZYX": i = f * h, j = f * e, k = c * h, l = c * e, this.n11 = g * h, this.n12 = k * d - j, this.n13 = i * d + l, this.n21 = g * e, this.n22 = l * d + i, this.n23 = j * d - k, this.n31 = -d, this.n32 = c * g, this.n33 = f * g; break; case "YZX": i = f * g, j = f * d, k = c * g, l = c * d, this.n11 = g * h, this.n12 = l - i * e, this.n13 = k * e + j, this.n21 = e, this.n22 = f * h, this.n23 = -c * h, this.n31 = -d * h, this.n32 = j * e + k, this.n33 = i - l * e; break; case "XZY": i = f * g, j = f * d, k = c * g, l = c * d, this.n11 = g * h, this.n12 = -e, this.n13 = d * h, this.n21 = i * e + l, this.n22 = f * h, this.n23 = j * e - k, this.n31 = k * e - j, this.n32 = c * h, this.n33 = l * e + i; break; default: i = f * h, j = f * e, k = c * h, l = c * e, this.n11 = g * h, this.n12 = -g * e, this.n13 = d, this.n21 = j + k * d, this.n22 = i - l * d, this.n23 = -c * g, this.n31 = l - i * d, this.n32 = k + j * d, this.n33 = f * g } return this }, setRotationFromQuaternion: function (a) { var b = a.x, c = a.y, d = a.z, e = a.w, f = b + b, g = c + c, h = d + d, a = b * f, i = b * g; b *= h; var j = c * g; return c *= h, d *= h, f *= e, g *= e, e *= h, this.n11 = 1 - (j + d), this.n12 = i - e, this.n13 = b + g, this.n21 = i + e, this.n22 = 1 - (a + d), this.n23 = c - f, this.n31 = b - g, this.n32 = c + f, this.n33 = 1 - (a + j), this }, scale: function (a) { var b = a.x, c = a.y, a = a.z; return this.n11 *= b, this.n12 *= c, this.n13 *= a, this.n21 *= b, this.n22 *= c, this.n23 *= a, this.n31 *= b, this.n32 *= c, this.n33 *= a, this.n41 *= b, this.n42 *= c, this.n43 *= a, this }, compose: function (a, b, c) { var d = THREE.Matrix4.__m1, e = THREE.Matrix4.__m2; return d.identity(), d.setRotationFromQuaternion(b), e.setScale(c.x, c.y, c.z), this.multiply(d, e), this.n14 = a.x, this.n24 = a.y, this.n34 = a.z, this }, decompose: function (a, b, c) { var d = THREE.Matrix4.__v1, e = THREE.Matrix4.__v2, f = THREE.Matrix4.__v3; return d.set(this.n11, this.n21, this.n31), e.set(this.n12, this.n22, this.n32), f.set(this.n13, this.n23, this.n33), a = a instanceof THREE.Vector3 ? a : new THREE.Vector3, b = b instanceof THREE.Quaternion ? b : new THREE.Quaternion, c = c instanceof THREE.Vector3 ? c : new THREE.Vector3, c.x = d.length(), c.y = e.length(), c.z = f.length(), a.x = this.n14, a.y = this.n24, a.z = this.n34, d = THREE.Matrix4.__m1, d.copy(this), d.n11 /= c.x, d.n21 /= c.x, d.n31 /= c.x, d.n12 /= c.y, d.n22 /= c.y, d.n32 /= c.y, d.n13 /= c.z, d.n23 /= c.z, d.n33 /= c.z, b.setFromRotationMatrix(d), [a, b, c] }, extractPosition: function (a) { return this.n14 = a.n14, this.n24 = a.n24, this.n34 = a.n34, this }, extractRotation: function (a) { var b = THREE.Matrix4.__v1, c = 1 / b.set(a.n11, a.n21, a.n31).length(), d = 1 / b.set(a.n12, a.n22, a.n32).length(), b = 1 / b.set(a.n13, a.n23, a.n33).length(); return this.n11 = a.n11 * c, this.n21 = a.n21 * c, this.n31 = a.n31 * c, this.n12 = a.n12 * d, this.n22 = a.n22 * d, this.n32 = a.n32 * d, this.n13 = a.n13 * b, this.n23 = a.n23 * b, this.n33 = a.n33 * b, this }
}, THREE.Matrix4.makeInvert3x3 = function (a) { var b = a.m33, c = b.m, d = a.n33 * a.n22 - a.n32 * a.n23, e = -a.n33 * a.n21 + a.n31 * a.n23, f = a.n32 * a.n21 - a.n31 * a.n22, g = -a.n33 * a.n12 + a.n32 * a.n13, h = a.n33 * a.n11 - a.n31 * a.n13, i = -a.n32 * a.n11 + a.n31 * a.n12, j = a.n23 * a.n12 - a.n22 * a.n13, k = -a.n23 * a.n11 + a.n21 * a.n13, l = a.n22 * a.n11 - a.n21 * a.n12, a = a.n11 * d + a.n21 * g + a.n31 * j; return 0 === a && console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible."), a = 1 / a, c[0] = a * d, c[1] = a * e, c[2] = a * f, c[3] = a * g, c[4] = a * h, c[5] = a * i, c[6] = a * j, c[7] = a * k, c[8] = a * l, b }, THREE.Matrix4.makeFrustum = function (a, b, c, d, e, f) { var g; return g = new THREE.Matrix4, g.n11 = 2 * e / (b - a), g.n12 = 0, g.n13 = (b + a) / (b - a), g.n14 = 0, g.n21 = 0, g.n22 = 2 * e / (d - c), g.n23 = (d + c) / (d - c), g.n24 = 0, g.n31 = 0, g.n32 = 0, g.n33 = -(f + e) / (f - e), g.n34 = -2 * f * e / (f - e), g.n41 = 0, g.n42 = 0, g.n43 = -1, g.n44 = 0, g }, THREE.Matrix4.makePerspective = function (a, b, c, d) { var e, a = c * Math.tan(a * Math.PI / 360); return e = -a, THREE.Matrix4.makeFrustum(e * b, a * b, e, a, c, d) }, THREE.Matrix4.makeOrtho = function (a, b, c, d, e, f) { var g, h, i, j; return g = new THREE.Matrix4, h = b - a, i = c - d, j = f - e, g.n11 = 2 / h, g.n12 = 0, g.n13 = 0, g.n14 = -((b + a) / h), g.n21 = 0, g.n22 = 2 / i, g.n23 = 0, g.n24 = -((c + d) / i), g.n31 = 0, g.n32 = 0, g.n33 = -2 / j, g.n34 = -((f + e) / j), g.n41 = 0, g.n42 = 0, g.n43 = 0, g.n44 = 1, g }, THREE.Matrix4.__v1 = new THREE.Vector3, THREE.Matrix4.__v2 = new THREE.Vector3, THREE.Matrix4.__v3 = new THREE.Vector3, THREE.Matrix4.__m1 = new THREE.Matrix4, THREE.Matrix4.__m2 = new THREE.Matrix4, THREE.Object3D = function () { this.name = "", this.id = THREE.Object3DCount++, this.parent = void 0, this.children = [], this.up = new THREE.Vector3(0, 1, 0), this.position = new THREE.Vector3, this.rotation = new THREE.Vector3, this.eulerOrder = "XYZ", this.scale = new THREE.Vector3(1, 1, 1), this.flipSided = this.doubleSided = this.dynamic = !1, this.renderDepth = null, this.rotationAutoUpdate = !0, this.matrix = new THREE.Matrix4, this.matrixWorld = new THREE.Matrix4, this.matrixRotationWorld = new THREE.Matrix4, this.matrixWorldNeedsUpdate = this.matrixAutoUpdate = !0, this.quaternion = new THREE.Quaternion, this.useQuaternion = !1, this.boundRadius = 0, this.boundRadiusScale = 1, this.visible = !0, this.receiveShadow = this.castShadow = !1, this.frustumCulled = !0, this._vector = new THREE.Vector3 }, THREE.Object3D.prototype = { constructor: THREE.Object3D, translate: function (a, b) { this.matrix.rotateAxis(b), this.position.addSelf(b.multiplyScalar(a)) }, translateX: function (a) { this.translate(a, this._vector.set(1, 0, 0)) }, translateY: function (a) { this.translate(a, this._vector.set(0, 1, 0)) }, translateZ: function (a) { this.translate(a, this._vector.set(0, 0, 1)) }, lookAt: function (a) { this.matrix.lookAt(a, this.position, this.up), this.rotationAutoUpdate && this.rotation.setRotationFromMatrix(this.matrix) }, add: function (a) { if (-1 === this.children.indexOf(a)) { void 0 !== a.parent && a.parent.remove(a), a.parent = this, this.children.push(a); for (var b = this; void 0 !== b.parent;) b = b.parent; void 0 !== b && b instanceof THREE.Scene && b.addObject(a) } }, remove: function (a) { var b = this.children.indexOf(a); if (-1 !== b) { for (a.parent = void 0, this.children.splice(b, 1), b = this; void 0 !== b.parent;) b = b.parent; void 0 !== b && b instanceof THREE.Scene && b.removeObject(a) } }, getChildByName: function (a, b) { var c, d, e; for (c = 0, d = this.children.length; d > c; c++) { if (e = this.children[c], e.name === a) return e; if (b && (e = e.getChildByName(a, b), void 0 !== e)) return e } }, updateMatrix: function () { this.matrix.setPosition(this.position), this.useQuaternion ? this.matrix.setRotationFromQuaternion(this.quaternion) : this.matrix.setRotationFromEuler(this.rotation, this.eulerOrder), (1 !== this.scale.x || 1 !== this.scale.y || 1 !== this.scale.z) && (this.matrix.scale(this.scale), this.boundRadiusScale = Math.max(this.scale.x, Math.max(this.scale.y, this.scale.z))), this.matrixWorldNeedsUpdate = !0 }, updateMatrixWorld: function (a) { this.matrixAutoUpdate && this.updateMatrix(), (this.matrixWorldNeedsUpdate || a) && (this.parent ? this.matrixWorld.multiply(this.parent.matrixWorld, this.matrix) : this.matrixWorld.copy(this.matrix), this.matrixWorldNeedsUpdate = !1, a = !0); for (var b = 0, c = this.children.length; c > b; b++) this.children[b].updateMatrixWorld(a) } }, THREE.Object3DCount = 0, THREE.Projector = function () { function a() { var a = p[f] = p[f] || new THREE.RenderableObject; return f++, a } function b() { var a = q[h] = q[h] || new THREE.RenderableVertex; return h++, a } function c(a, b) { return b.z - a.z } function d(a, b) { var c = 0, d = 1, e = a.z + a.w, f = b.z + b.w, g = -a.z + a.w, h = -b.z + b.w; return e >= 0 && f >= 0 && g >= 0 && h >= 0 ? !0 : 0 > e && 0 > f || 0 > g && 0 > h ? !1 : (0 > e ? c = Math.max(c, e / (e - f)) : 0 > f && (d = Math.min(d, e / (e - f))), 0 > g ? c = Math.max(c, g / (g - h)) : 0 > h && (d = Math.min(d, g / (g - h))), c > d ? !1 : (a.lerpSelf(b, c), b.lerpSelf(a, 1 - d), !0)) } var e, f, g, h, i, j, k, l, m, n, o, p = [], q = [], r = [], s = [], t = [], u = [], v = { objects: [], sprites: [], lights: [], elements: [] }, w = new THREE.Vector3, x = new THREE.Vector4, y = new THREE.Matrix4, z = new THREE.Matrix4, A = [new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4, new THREE.Vector4], B = new THREE.Vector4, C = new THREE.Vector4; this.computeFrustum = function (a) { for (A[0].set(a.n41 - a.n11, a.n42 - a.n12, a.n43 - a.n13, a.n44 - a.n14), A[1].set(a.n41 + a.n11, a.n42 + a.n12, a.n43 + a.n13, a.n44 + a.n14), A[2].set(a.n41 + a.n21, a.n42 + a.n22, a.n43 + a.n23, a.n44 + a.n24), A[3].set(a.n41 - a.n21, a.n42 - a.n22, a.n43 - a.n23, a.n44 - a.n24), A[4].set(a.n41 - a.n31, a.n42 - a.n32, a.n43 - a.n33, a.n44 - a.n34), A[5].set(a.n41 + a.n31, a.n42 + a.n32, a.n43 + a.n33, a.n44 + a.n34), a = 0; 6 > a; a++) { var b = A[a]; b.divideScalar(Math.sqrt(b.x * b.x + b.y * b.y + b.z * b.z)) } }, this.projectVector = function (a, b) { return b.matrixWorldInverse.getInverse(b.matrixWorld), y.multiply(b.projectionMatrix, b.matrixWorldInverse), y.multiplyVector3(a), a }, this.unprojectVector = function (a, b) { return b.projectionMatrixInverse.getInverse(b.projectionMatrix), y.multiply(b.matrixWorld, b.projectionMatrixInverse), y.multiplyVector3(a), a }, this.pickingRay = function (a, b) { var c; return a.z = -1, c = new THREE.Vector3(a.x, a.y, 1), this.unprojectVector(a, b), this.unprojectVector(c, b), c.subSelf(a).normalize(), new THREE.Ray(a, c) }, this.projectGraph = function (b, d) { f = 0, v.objects.length = 0, v.sprites.length = 0, v.lights.length = 0; var g = function (b) { if (b.visible !== !1) { var c; if ((c = b instanceof THREE.Mesh || b instanceof THREE.Line) && !(c = b.frustumCulled === !1)) a: { for (var d = b.matrixWorld, f = -b.geometry.boundingSphere.radius * Math.max(b.scale.x, Math.max(b.scale.y, b.scale.z)), h = 0; 6 > h; h++) if (c = A[h].x * d.n14 + A[h].y * d.n24 + A[h].z * d.n34 + A[h].w, f >= c) { c = !1; break a } c = !0 } for (c ? (y.multiplyVector3(w.copy(b.position)), e = a(), e.object = b, e.z = w.z, v.objects.push(e)) : b instanceof THREE.Sprite || b instanceof THREE.Particle ? (y.multiplyVector3(w.copy(b.position)), e = a(), e.object = b, e.z = w.z, v.sprites.push(e)) : b instanceof THREE.Light && v.lights.push(b), c = 0, d = b.children.length; d > c; c++) g(b.children[c]) } }; return g(b), d && v.objects.sort(c), v }, this.projectScene = function (a, e, f) { var p, w, A, D, E, F, G, H, I, J, K, L, M, N, O, P, Q = e.near, R = e.far; for (o = m = k = j = 0, v.elements.length = 0, void 0 === e.parent && (console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."), a.add(e)), a.updateMatrixWorld(), e.matrixWorldInverse.getInverse(e.matrixWorld), y.multiply(e.projectionMatrix, e.matrixWorldInverse), this.computeFrustum(y), v = this.projectGraph(a, !1), a = 0, p = v.objects.length; p > a; a++) if (I = v.objects[a].object, J = I.matrixWorld, L = I.material, h = 0, I instanceof THREE.Mesh) { for (K = I.geometry, M = I.geometry.materials, D = K.vertices, N = K.faces, O = K.faceVertexUvs, K = I.matrixRotationWorld.extractRotation(J), w = 0, A = D.length; A > w; w++) g = b(), g.positionWorld.copy(D[w].position), J.multiplyVector3(g.positionWorld), g.positionScreen.copy(g.positionWorld), y.multiplyVector4(g.positionScreen), g.positionScreen.x /= g.positionScreen.w, g.positionScreen.y /= g.positionScreen.w, g.visible = g.positionScreen.z > Q && g.positionScreen.z < R; for (D = 0, w = N.length; w > D; D++) { if (A = N[D], A instanceof THREE.Face3) { if (E = q[A.a], F = q[A.b], G = q[A.c], !(E.visible && F.visible && G.visible) || !I.doubleSided && I.flipSided == (G.positionScreen.x - E.positionScreen.x) * (F.positionScreen.y - E.positionScreen.y) - (G.positionScreen.y - E.positionScreen.y) * (F.positionScreen.x - E.positionScreen.x) < 0) continue; H = r[j] = r[j] || new THREE.RenderableFace3, j++, i = H, i.v1.copy(E), i.v2.copy(F), i.v3.copy(G) } else if (A instanceof THREE.Face4) { if (E = q[A.a], F = q[A.b], G = q[A.c], H = q[A.d], !(E.visible && F.visible && G.visible && H.visible) || !I.doubleSided && I.flipSided == ((H.positionScreen.x - E.positionScreen.x) * (F.positionScreen.y - E.positionScreen.y) - (H.positionScreen.y - E.positionScreen.y) * (F.positionScreen.x - E.positionScreen.x) < 0 || (F.positionScreen.x - G.positionScreen.x) * (H.positionScreen.y - G.positionScreen.y) - (F.positionScreen.y - G.positionScreen.y) * (H.positionScreen.x - G.positionScreen.x) < 0)) continue; P = s[k] = s[k] || new THREE.RenderableFace4, k++, i = P, i.v1.copy(E), i.v2.copy(F), i.v3.copy(G), i.v4.copy(H) } for (i.normalWorld.copy(A.normal), K.multiplyVector3(i.normalWorld), i.centroidWorld.copy(A.centroid), J.multiplyVector3(i.centroidWorld), i.centroidScreen.copy(i.centroidWorld), y.multiplyVector3(i.centroidScreen), G = A.vertexNormals, E = 0, F = G.length; F > E; E++) H = i.vertexNormalsWorld[E], H.copy(G[E]), K.multiplyVector3(H); for (E = 0, F = O.length; F > E; E++) if (P = O[E][D]) for (G = 0, H = P.length; H > G; G++) i.uvs[E][G] = P[G]; i.material = L, i.faceMaterial = null !== A.materialIndex ? M[A.materialIndex] : null, i.z = i.centroidScreen.z, v.elements.push(i) } } else if (I instanceof THREE.Line) for (z.multiply(y, J), D = I.geometry.vertices, E = b(), E.positionScreen.copy(D[0].position), z.multiplyVector4(E.positionScreen), w = 1, A = D.length; A > w; w++) E = b(), E.positionScreen.copy(D[w].position), z.multiplyVector4(E.positionScreen), F = q[h - 2], B.copy(E.positionScreen), C.copy(F.positionScreen), d(B, C) && (B.multiplyScalar(1 / B.w), C.multiplyScalar(1 / C.w), I = t[m] = t[m] || new THREE.RenderableLine, m++, l = I, l.v1.positionScreen.copy(B), l.v2.positionScreen.copy(C), l.z = Math.max(B.z, C.z), l.material = L, v.elements.push(l)); for (a = 0, p = v.sprites.length; p > a; a++) I = v.sprites[a].object, J = I.matrixWorld, I instanceof THREE.Particle && (x.set(J.n14, J.n24, J.n34, 1), y.multiplyVector4(x), x.z /= x.w, x.z > 0 && x.z < 1) && (Q = u[o] = u[o] || new THREE.RenderableParticle, o++, n = Q, n.x = x.x / x.w, n.y = x.y / x.w, n.z = x.z, n.rotation = I.rotation.z, n.scale.x = I.scale.x * Math.abs(n.x - (x.x + e.projectionMatrix.n11) / (x.w + e.projectionMatrix.n14)), n.scale.y = I.scale.y * Math.abs(n.y - (x.y + e.projectionMatrix.n22) / (x.w + e.projectionMatrix.n24)), n.material = I.material, v.elements.push(n)); return f && v.elements.sort(c), v } }, THREE.Quaternion = function (a, b, c, d) { this.set(a || 0, b || 0, c || 0, void 0 !== d ? d : 1) }, THREE.Quaternion.prototype = { constructor: THREE.Quaternion, set: function (a, b, c, d) { return this.x = a, this.y = b, this.z = c, this.w = d, this }, copy: function (a) { return this.x = a.x, this.y = a.y, this.z = a.z, this.w = a.w, this }, setFromEuler: function (a) { var b = Math.PI / 360, c = a.x * b, d = a.y * b, e = a.z * b, a = Math.cos(d), d = Math.sin(d), b = Math.cos(-e), e = Math.sin(-e), f = Math.cos(c), c = Math.sin(c), g = a * b, h = d * e; return this.w = g * f - h * c, this.x = g * c + h * f, this.y = d * b * f + a * e * c, this.z = a * e * f - d * b * c, this }, setFromAxisAngle: function (a, b) { var c = b / 2, d = Math.sin(c); return this.x = a.x * d, this.y = a.y * d, this.z = a.z * d, this.w = Math.cos(c), this }, setFromRotationMatrix: function (a) { var b = Math.pow(a.determinant(), 1 / 3); return this.w = Math.sqrt(Math.max(0, b + a.n11 + a.n22 + a.n33)) / 2, this.x = Math.sqrt(Math.max(0, b + a.n11 - a.n22 - a.n33)) / 2, this.y = Math.sqrt(Math.max(0, b - a.n11 + a.n22 - a.n33)) / 2, this.z = Math.sqrt(Math.max(0, b - a.n11 - a.n22 + a.n33)) / 2, this.x = a.n32 - a.n23 < 0 ? -Math.abs(this.x) : Math.abs(this.x), this.y = a.n13 - a.n31 < 0 ? -Math.abs(this.y) : Math.abs(this.y), this.z = a.n21 - a.n12 < 0 ? -Math.abs(this.z) : Math.abs(this.z), this.normalize(), this }, calculateW: function () { return this.w = -Math.sqrt(Math.abs(1 - this.x * this.x - this.y * this.y - this.z * this.z)), this }, inverse: function () { return this.x *= -1, this.y *= -1, this.z *= -1, this }, length: function () { return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w) }, normalize: function () { var a = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w); return 0 === a ? this.w = this.z = this.y = this.x = 0 : (a = 1 / a, this.x *= a, this.y *= a, this.z *= a, this.w *= a), this }, multiplySelf: function (a) { var b = this.x, c = this.y, d = this.z, e = this.w, f = a.x, g = a.y, h = a.z, a = a.w; return this.x = b * a + e * f + c * h - d * g, this.y = c * a + e * g + d * f - b * h, this.z = d * a + e * h + b * g - c * f, this.w = e * a - b * f - c * g - d * h, this }, multiply: function (a, b) { return this.x = a.x * b.w + a.y * b.z - a.z * b.y + a.w * b.x, this.y = -a.x * b.z + a.y * b.w + a.z * b.x + a.w * b.y, this.z = a.x * b.y - a.y * b.x + a.z * b.w + a.w * b.z, this.w = -a.x * b.x - a.y * b.y - a.z * b.z + a.w * b.w, this }, multiplyVector3: function (a, b) { b || (b = a); var c = a.x, d = a.y, e = a.z, f = this.x, g = this.y, h = this.z, i = this.w, j = i * c + g * e - h * d, k = i * d + h * c - f * e, l = i * e + f * d - g * c, c = -f * c - g * d - h * e; return b.x = j * i + c * -f + k * -h - l * -g, b.y = k * i + c * -g + l * -f - j * -h, b.z = l * i + c * -h + j * -g - k * -f, b } }, THREE.Quaternion.slerp = function (a, b, c, d) { var e = a.w * b.w + a.x * b.x + a.y * b.y + a.z * b.z; if (0 > e ? (c.w = -b.w, c.x = -b.x, c.y = -b.y, c.z = -b.z, e = -e) : c.copy(b), Math.abs(e) >= 1) return c.w = a.w, c.x = a.x, c.y = a.y, c.z = a.z, c; var f = Math.acos(e), e = Math.sqrt(1 - e * e); return Math.abs(e) < .001 ? (c.w = .5 * (a.w + b.w), c.x = .5 * (a.x + b.x), c.y = .5 * (a.y + b.y), c.z = .5 * (a.z + b.z), c) : (b = Math.sin((1 - d) * f) / e, d = Math.sin(d * f) / e, c.w = a.w * b + c.w * d, c.x = a.x * b + c.x * d, c.y = a.y * b + c.y * d, c.z = a.z * b + c.z * d, c) }, THREE.Vertex = function (a) { this.position = a || new THREE.Vector3 }, THREE.Face3 = function (a, b, c, d, e, f) { this.a = a, this.b = b, this.c = c, this.normal = d instanceof THREE.Vector3 ? d : new THREE.Vector3, this.vertexNormals = d instanceof Array ? d : [], this.color = e instanceof THREE.Color ? e : new THREE.Color, this.vertexColors = e instanceof Array ? e : [], this.vertexTangents = [], this.materialIndex = f, this.centroid = new THREE.Vector3 }, THREE.Face4 = function (a, b, c, d, e, f, g) { this.a = a, this.b = b, this.c = c, this.d = d, this.normal = e instanceof THREE.Vector3 ? e : new THREE.Vector3, this.vertexNormals = e instanceof Array ? e : [], this.color = f instanceof THREE.Color ? f : new THREE.Color, this.vertexColors = f instanceof Array ? f : [], this.vertexTangents = [], this.materialIndex = g, this.centroid = new THREE.Vector3 }, THREE.UV = function (a, b) { this.u = a || 0, this.v = b || 0 }, THREE.UV.prototype = { constructor: THREE.UV, set: function (a, b) { return this.u = a, this.v = b, this }, copy: function (a) { return this.u = a.u, this.v = a.v, this }, clone: function () { return new THREE.UV(this.u, this.v) } }, THREE.Geometry = function () { this.id = THREE.GeometryCount++, this.vertices = [], this.colors = [], this.materials = [], this.faces = [], this.faceUvs = [[]], this.faceVertexUvs = [[]], this.morphTargets = [], this.morphColors = [], this.skinWeights = [], this.skinIndices = [], this.boundingSphere = this.boundingBox = null, this.dynamic = this.hasTangents = !1 }, THREE.Geometry.prototype = { constructor: THREE.Geometry, applyMatrix: function (a) { var b = new THREE.Matrix4; b.extractRotation(a, new THREE.Vector3(1, 1, 1)); for (var c = 0, d = this.vertices.length; d > c; c++) a.multiplyVector3(this.vertices[c].position); for (c = 0, d = this.faces.length; d > c; c++) { var e = this.faces[c]; b.multiplyVector3(e.normal); for (var f = 0, g = e.vertexNormals.length; g > f; f++) b.multiplyVector3(e.vertexNormals[f]); a.multiplyVector3(e.centroid) } }, computeCentroids: function () { var a, b, c; for (a = 0, b = this.faces.length; b > a; a++) c = this.faces[a], c.centroid.set(0, 0, 0), c instanceof THREE.Face3 ? (c.centroid.addSelf(this.vertices[c.a].position), c.centroid.addSelf(this.vertices[c.b].position), c.centroid.addSelf(this.vertices[c.c].position), c.centroid.divideScalar(3)) : c instanceof THREE.Face4 && (c.centroid.addSelf(this.vertices[c.a].position), c.centroid.addSelf(this.vertices[c.b].position), c.centroid.addSelf(this.vertices[c.c].position), c.centroid.addSelf(this.vertices[c.d].position), c.centroid.divideScalar(4)) }, computeFaceNormals: function () { var a, b, c, d, e, f, g = new THREE.Vector3, h = new THREE.Vector3; for (a = 0, b = this.faces.length; b > a; a++) c = this.faces[a], d = this.vertices[c.a], e = this.vertices[c.b], f = this.vertices[c.c], g.sub(f.position, e.position), h.sub(d.position, e.position), g.crossSelf(h), g.isZero() || g.normalize(), c.normal.copy(g) }, computeVertexNormals: function () { var a, b, c, d; if (void 0 === this.__tmpVertices) { for (d = this.__tmpVertices = Array(this.vertices.length), a = 0, b = this.vertices.length; b > a; a++) d[a] = new THREE.Vector3; for (a = 0, b = this.faces.length; b > a; a++) c = this.faces[a], c instanceof THREE.Face3 ? c.vertexNormals = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3] : c instanceof THREE.Face4 && (c.vertexNormals = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3]) } else for (d = this.__tmpVertices, a = 0, b = this.vertices.length; b > a; a++) d[a].set(0, 0, 0); for (a = 0, b = this.faces.length; b > a; a++) c = this.faces[a], c instanceof THREE.Face3 ? (d[c.a].addSelf(c.normal), d[c.b].addSelf(c.normal), d[c.c].addSelf(c.normal)) : c instanceof THREE.Face4 && (d[c.a].addSelf(c.normal), d[c.b].addSelf(c.normal), d[c.c].addSelf(c.normal), d[c.d].addSelf(c.normal)); for (a = 0, b = this.vertices.length; b > a; a++) d[a].normalize(); for (a = 0, b = this.faces.length; b > a; a++) c = this.faces[a], c instanceof THREE.Face3 ? (c.vertexNormals[0].copy(d[c.a]), c.vertexNormals[1].copy(d[c.b]), c.vertexNormals[2].copy(d[c.c])) : c instanceof THREE.Face4 && (c.vertexNormals[0].copy(d[c.a]), c.vertexNormals[1].copy(d[c.b]), c.vertexNormals[2].copy(d[c.c]), c.vertexNormals[3].copy(d[c.d])) }, computeTangents: function () { function a(a, b, c, d, e, f, y) { h = a.vertices[b].position, i = a.vertices[c].position, j = a.vertices[d].position, k = g[e], l = g[f], m = g[y], n = i.x - h.x, o = j.x - h.x, p = i.y - h.y, q = j.y - h.y, r = i.z - h.z, s = j.z - h.z, t = l.u - k.u, u = m.u - k.u, v = l.v - k.v, w = m.v - k.v, x = 1 / (t * w - u * v), B.set((w * n - v * o) * x, (w * p - v * q) * x, (w * r - v * s) * x), C.set((t * o - u * n) * x, (t * q - u * p) * x, (t * s - u * r) * x), z[b].addSelf(B), z[c].addSelf(B), z[d].addSelf(B), A[b].addSelf(C), A[c].addSelf(C), A[d].addSelf(C) } var b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z = [], A = [], B = new THREE.Vector3, C = new THREE.Vector3, D = new THREE.Vector3, E = new THREE.Vector3, F = new THREE.Vector3; for (b = 0, c = this.vertices.length; c > b; b++) z[b] = new THREE.Vector3, A[b] = new THREE.Vector3; for (b = 0, c = this.faces.length; c > b; b++) f = this.faces[b], g = this.faceVertexUvs[0][b], f instanceof THREE.Face3 ? a(this, f.a, f.b, f.c, 0, 1, 2) : f instanceof THREE.Face4 && (a(this, f.a, f.b, f.c, 0, 1, 2), a(this, f.a, f.b, f.d, 0, 1, 3)); var G = ["a", "b", "c", "d"]; for (b = 0, c = this.faces.length; c > b; b++) for (f = this.faces[b], d = 0; d < f.vertexNormals.length; d++) F.copy(f.vertexNormals[d]), e = f[G[d]], y = z[e], D.copy(y), D.subSelf(F.multiplyScalar(F.dot(y))).normalize(), E.cross(f.vertexNormals[d], y), e = E.dot(A[e]), e = 0 > e ? -1 : 1, f.vertexTangents[d] = new THREE.Vector4(D.x, D.y, D.z, e); this.hasTangents = !0 }, computeBoundingBox: function () { var a; if (this.vertices.length > 0) { this.boundingBox = { x: [this.vertices[0].position.x, this.vertices[0].position.x], y: [this.vertices[0].position.y, this.vertices[0].position.y], z: [this.vertices[0].position.z, this.vertices[0].position.z] }; for (var b = 1, c = this.vertices.length; c > b; b++) a = this.vertices[b], a.position.x < this.boundingBox.x[0] ? this.boundingBox.x[0] = a.position.x : a.position.x > this.boundingBox.x[1] && (this.boundingBox.x[1] = a.position.x), a.position.y < this.boundingBox.y[0] ? this.boundingBox.y[0] = a.position.y : a.position.y > this.boundingBox.y[1] && (this.boundingBox.y[1] = a.position.y), a.position.z < this.boundingBox.z[0] ? this.boundingBox.z[0] = a.position.z : a.position.z > this.boundingBox.z[1] && (this.boundingBox.z[1] = a.position.z) } }, computeBoundingSphere: function () { for (var a = 0, b = 0, c = this.vertices.length; c > b; b++) a = Math.max(a, this.vertices[b].position.length()); this.boundingSphere = { radius: a } }, mergeVertices: function () { var a, b, c, d = {}, e = [], f = [], g = Math.pow(10, 4); for (b = 0, c = this.vertices.length; c > b; b++) a = this.vertices[b].position, a = [Math.round(a.x * g), Math.round(a.y * g), Math.round(a.z * g)].join("_"), void 0 === d[a] ? (d[a] = b, e.push(this.vertices[b]), f[b] = e.length - 1) : f[b] = f[d[a]]; for (b = 0, c = this.faces.length; c > b; b++) d = this.faces[b], d instanceof THREE.Face3 ? (d.a = f[d.a], d.b = f[d.b], d.c = f[d.c]) : d instanceof THREE.Face4 && (d.a = f[d.a], d.b = f[d.b], d.c = f[d.c], d.d = f[d.d]); this.vertices = e } }, THREE.GeometryCount = 0, THREE.Camera = function () { return arguments.length ? (console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."), new THREE.PerspectiveCamera(arguments[0], arguments[1], arguments[2], arguments[3])) : (THREE.Object3D.call(this), this.matrixWorldInverse = new THREE.Matrix4, this.projectionMatrix = new THREE.Matrix4, this.projectionMatrixInverse = new THREE.Matrix4, void 0) }, THREE.Camera.prototype = new THREE.Object3D, THREE.Camera.prototype.constructor = THREE.Camera, THREE.Camera.prototype.lookAt = function (a) { this.matrix.lookAt(this.position, a, this.up), this.rotationAutoUpdate && this.rotation.setRotationFromMatrix(this.matrix) }, THREE.OrthographicCamera = function (a, b, c, d, e, f) { THREE.Camera.call(this), this.left = a, this.right = b, this.top = c, this.bottom = d, this.near = void 0 !== e ? e : .1, this.far = void 0 !== f ? f : 2e3, this.updateProjectionMatrix() }, THREE.OrthographicCamera.prototype = new THREE.Camera, THREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera, THREE.OrthographicCamera.prototype.updateProjectionMatrix = function () { this.projectionMatrix = THREE.Matrix4.makeOrtho(this.left, this.right, this.top, this.bottom, this.near, this.far) }, THREE.PerspectiveCamera = function (a, b, c, d) { THREE.Camera.call(this), this.fov = void 0 !== a ? a : 50, this.aspect = void 0 !== b ? b : 1, this.near = void 0 !== c ? c : .1, this.far = void 0 !== d ? d : 2e3, this.updateProjectionMatrix() }, THREE.PerspectiveCamera.prototype = new THREE.Camera, THREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera, THREE.PerspectiveCamera.prototype.setLens = function (a, b) { this.fov = 2 * Math.atan((void 0 !== b ? b : 43.25) / (2 * a)), this.fov *= 180 / Math.PI, this.updateProjectionMatrix() }, THREE.PerspectiveCamera.prototype.setViewOffset = function (a, b, c, d, e, f) { this.fullWidth = a, this.fullHeight = b, this.x = c, this.y = d, this.width = e, this.height = f, this.updateProjectionMatrix() }, THREE.PerspectiveCamera.prototype.updateProjectionMatrix = function () { if (this.fullWidth) { var a = this.fullWidth / this.fullHeight, b = Math.tan(this.fov * Math.PI / 360) * this.near, c = -b, d = a * c, a = Math.abs(a * b - d), c = Math.abs(b - c); this.projectionMatrix = THREE.Matrix4.makeFrustum(d + this.x * a / this.fullWidth, d + (this.x + this.width) * a / this.fullWidth, b - (this.y + this.height) * c / this.fullHeight, b - this.y * c / this.fullHeight, this.near, this.far) } else this.projectionMatrix = THREE.Matrix4.makePerspective(this.fov, this.aspect, this.near, this.far) }, THREE.Light = function (a) { THREE.Object3D.call(this), this.color = new THREE.Color(a) }, THREE.Light.prototype = new THREE.Object3D, THREE.Light.prototype.constructor = THREE.Light, THREE.Light.prototype.supr = THREE.Object3D.prototype, THREE.AmbientLight = function (a) { THREE.Light.call(this, a) }, THREE.AmbientLight.prototype = new THREE.Light, THREE.AmbientLight.prototype.constructor = THREE.AmbientLight, THREE.DirectionalLight = function (a, b, c) { THREE.Light.call(this, a), this.position = new THREE.Vector3(0, 1, 0), this.intensity = void 0 !== b ? b : 1, this.distance = void 0 !== c ? c : 0 }, THREE.DirectionalLight.prototype = new THREE.Light, THREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight, THREE.PointLight = function (a, b, c) { THREE.Light.call(this, a), this.position = new THREE.Vector3(0, 0, 0), this.intensity = void 0 !== b ? b : 1, this.distance = void 0 !== c ? c : 0 }, THREE.PointLight.prototype = new THREE.Light, THREE.PointLight.prototype.constructor = THREE.PointLight, THREE.Material = function (a) { this.name = "", this.id = THREE.MaterialCount++, a = a || {}, this.opacity = void 0 !== a.opacity ? a.opacity : 1, this.transparent = void 0 !== a.transparent ? a.transparent : !1, this.blending = void 0 !== a.blending ? a.blending : THREE.NormalBlending, this.depthTest = void 0 !== a.depthTest ? a.depthTest : !0, this.depthWrite = void 0 !== a.depthWrite ? a.depthWrite : !0, this.polygonOffset = void 0 !== a.polygonOffset ? a.polygonOffset : !1, this.polygonOffsetFactor = void 0 !== a.polygonOffsetFactor ? a.polygonOffsetFactor : 0, this.polygonOffsetUnits = void 0 !== a.polygonOffsetUnits ? a.polygonOffsetUnits : 0, this.alphaTest = void 0 !== a.alphaTest ? a.alphaTest : 0, this.overdraw = void 0 !== a.overdraw ? a.overdraw : !1 }, THREE.MaterialCount = 0, THREE.NoShading = 0, THREE.FlatShading = 1, THREE.SmoothShading = 2, THREE.NoColors = 0, THREE.FaceColors = 1, THREE.VertexColors = 2, THREE.NormalBlending = 0, THREE.AdditiveBlending = 1, THREE.SubtractiveBlending = 2, THREE.MultiplyBlending = 3, THREE.AdditiveAlphaBlending = 4, THREE.LineBasicMaterial = function (a) { THREE.Material.call(this, a), a = a || {}, this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215), this.linewidth = void 0 !== a.linewidth ? a.linewidth : 1, this.linecap = void 0 !== a.linecap ? a.linecap : "round", this.linejoin = void 0 !== a.linejoin ? a.linejoin : "round", this.vertexColors = a.vertexColors ? a.vertexColors : !1, this.fog = void 0 !== a.fog ? a.fog : !0 }, THREE.LineBasicMaterial.prototype = new THREE.Material, THREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial, THREE.MeshBasicMaterial = function (a) { THREE.Material.call(this, a), a = a || {}, this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215), this.map = void 0 !== a.map ? a.map : null, this.lightMap = void 0 !== a.lightMap ? a.lightMap : null, this.envMap = void 0 !== a.envMap ? a.envMap : null, this.combine = void 0 !== a.combine ? a.combine : THREE.MultiplyOperation, this.reflectivity = void 0 !== a.reflectivity ? a.reflectivity : 1, this.refractionRatio = void 0 !== a.refractionRatio ? a.refractionRatio : .98, this.fog = void 0 !== a.fog ? a.fog : !0, this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading, this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1, this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1, this.wireframeLinecap = void 0 !== a.wireframeLinecap ? a.wireframeLinecap : "round", this.wireframeLinejoin = void 0 !== a.wireframeLinejoin ? a.wireframeLinejoin : "round", this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : !1, this.skinning = void 0 !== a.skinning ? a.skinning : !1, this.morphTargets = void 0 !== a.morphTargets ? a.morphTargets : !1 }, THREE.MeshBasicMaterial.prototype = new THREE.Material, THREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial, THREE.MeshLambertMaterial = function (a) { THREE.Material.call(this, a), a = a || {}, this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215), this.ambient = void 0 !== a.ambient ? new THREE.Color(a.ambient) : new THREE.Color(328965), this.map = void 0 !== a.map ? a.map : null, this.lightMap = void 0 !== a.lightMap ? a.lightMap : null, this.envMap = void 0 !== a.envMap ? a.envMap : null, this.combine = void 0 !== a.combine ? a.combine : THREE.MultiplyOperation, this.reflectivity = void 0 !== a.reflectivity ? a.reflectivity : 1, this.refractionRatio = void 0 !== a.refractionRatio ? a.refractionRatio : .98, this.fog = void 0 !== a.fog ? a.fog : !0, this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading, this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1, this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1, this.wireframeLinecap = void 0 !== a.wireframeLinecap ? a.wireframeLinecap : "round", this.wireframeLinejoin = void 0 !== a.wireframeLinejoin ? a.wireframeLinejoin : "round", this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : !1, this.skinning = void 0 !== a.skinning ? a.skinning : !1, this.morphTargets = void 0 !== a.morphTargets ? a.morphTargets : !1 }, THREE.MeshLambertMaterial.prototype = new THREE.Material, THREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial, THREE.MeshPhongMaterial = function (a) {
    THREE.Material.call(this, a), a = a || {}, this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215), this.ambient = void 0 !== a.ambient ? new THREE.Color(a.ambient) : new THREE.Color(328965), this.specular = void 0 !== a.specular ? new THREE.Color(a.specular) : new THREE.Color(1118481), this.shininess = void 0 !== a.shininess ? a.shininess : 30, this.metal = void 0 !== a.metal ? a.metal : !1, this.perPixel = void 0 !== a.perPixel ? a.perPixel : !1, this.map = void 0 !== a.map ? a.map : null, this.lightMap = void 0 !== a.lightMap ? a.lightMap : null, this.envMap = void 0 !== a.envMap ? a.envMap : null, this.combine = void 0 !== a.combine ? a.combine : THREE.MultiplyOperation, this.reflectivity = void 0 !== a.reflectivity ? a.reflectivity : 1, this.refractionRatio = void 0 !== a.refractionRatio ? a.refractionRatio : .98, this.fog = void 0 !== a.fog ? a.fog : !0, this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading, this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1, this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1, this.wireframeLinecap = void 0 !== a.wireframeLinecap ? a.wireframeLinecap : "round", this.wireframeLinejoin = void 0 !== a.wireframeLinejoin ? a.wireframeLinejoin : "round", this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : !1, this.skinning = void 0 !== a.skinning ? a.skinning : !1, this.morphTargets = void 0 !== a.morphTargets ? a.morphTargets : !1
}, THREE.MeshPhongMaterial.prototype = new THREE.Material, THREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial, THREE.MeshDepthMaterial = function (a) { THREE.Material.call(this, a), a = a || {}, this.shading = void 0 !== a.shading ? a.shading : THREE.SmoothShading, this.wireframe = void 0 !== a.wireframe ? a.wireframe : !1, this.wireframeLinewidth = void 0 !== a.wireframeLinewidth ? a.wireframeLinewidth : 1 }, THREE.MeshDepthMaterial.prototype = new THREE.Material, THREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial, THREE.MeshNormalMaterial = function (a) { THREE.Material.call(this, a), a = a || {}, this.shading = a.shading ? a.shading : THREE.FlatShading, this.wireframe = a.wireframe ? a.wireframe : !1, this.wireframeLinewidth = a.wireframeLinewidth ? a.wireframeLinewidth : 1 }, THREE.MeshNormalMaterial.prototype = new THREE.Material, THREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial, THREE.MeshFaceMaterial = function () { }, THREE.ParticleBasicMaterial = function (a) { THREE.Material.call(this, a), a = a || {}, this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215), this.map = void 0 !== a.map ? a.map : null, this.size = void 0 !== a.size ? a.size : 1, this.sizeAttenuation = void 0 !== a.sizeAttenuation ? a.sizeAttenuation : !0, this.vertexColors = void 0 !== a.vertexColors ? a.vertexColors : !1, this.fog = void 0 !== a.fog ? a.fog : !0 }, THREE.ParticleBasicMaterial.prototype = new THREE.Material, THREE.ParticleBasicMaterial.prototype.constructor = THREE.ParticleBasicMaterial, THREE.ParticleCanvasMaterial = function (a) { THREE.Material.call(this, a), a = a || {}, this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215), this.program = void 0 !== a.program ? a.program : function () { } }, THREE.ParticleCanvasMaterial.prototype = new THREE.Material, THREE.ParticleCanvasMaterial.prototype.constructor = THREE.ParticleCanvasMaterial, THREE.Texture = function (a, b, c, d, e, f) { this.id = THREE.TextureCount++, this.image = a, this.mapping = void 0 !== b ? b : new THREE.UVMapping, this.wrapS = void 0 !== c ? c : THREE.ClampToEdgeWrapping, this.wrapT = void 0 !== d ? d : THREE.ClampToEdgeWrapping, this.magFilter = void 0 !== e ? e : THREE.LinearFilter, this.minFilter = void 0 !== f ? f : THREE.LinearMipMapLinearFilter, this.offset = new THREE.Vector2(0, 0), this.repeat = new THREE.Vector2(1, 1), this.needsUpdate = !1, this.onUpdate = null }, THREE.Texture.prototype = { constructor: THREE.Texture, clone: function () { var a = new THREE.Texture(this.image, this.mapping, this.wrapS, this.wrapT, this.magFilter, this.minFilter); return a.offset.copy(this.offset), a.repeat.copy(this.repeat), a } }, THREE.TextureCount = 0, THREE.MultiplyOperation = 0, THREE.MixOperation = 1, THREE.CubeReflectionMapping = function () { }, THREE.CubeRefractionMapping = function () { }, THREE.LatitudeReflectionMapping = function () { }, THREE.LatitudeRefractionMapping = function () { }, THREE.SphericalReflectionMapping = function () { }, THREE.SphericalRefractionMapping = function () { }, THREE.UVMapping = function () { }, THREE.RepeatWrapping = 0, THREE.ClampToEdgeWrapping = 1, THREE.MirroredRepeatWrapping = 2, THREE.NearestFilter = 3, THREE.NearestMipMapNearestFilter = 4, THREE.NearestMipMapLinearFilter = 5, THREE.LinearFilter = 6, THREE.LinearMipMapNearestFilter = 7, THREE.LinearMipMapLinearFilter = 8, THREE.ByteType = 9, THREE.UnsignedByteType = 10, THREE.ShortType = 11, THREE.UnsignedShortType = 12, THREE.IntType = 13, THREE.UnsignedIntType = 14, THREE.FloatType = 15, THREE.AlphaFormat = 16, THREE.RGBFormat = 17, THREE.RGBAFormat = 18, THREE.LuminanceFormat = 19, THREE.LuminanceAlphaFormat = 20, THREE.Particle = function (a) { THREE.Object3D.call(this), this.material = a }, THREE.Particle.prototype = new THREE.Object3D, THREE.Particle.prototype.constructor = THREE.Particle, THREE.Line = function (a, b, c) { THREE.Object3D.call(this), this.geometry = a, this.material = b, this.type = void 0 !== c ? c : THREE.LineStrip, this.geometry && (this.geometry.boundingSphere || this.geometry.computeBoundingSphere()) }, THREE.LineStrip = 0, THREE.LinePieces = 1, THREE.Line.prototype = new THREE.Object3D, THREE.Line.prototype.constructor = THREE.Line, THREE.Mesh = function (a, b) { if (THREE.Object3D.call(this), this.geometry = a, this.material = b, b instanceof Array && (console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."), this.material = b[0]), this.geometry && (this.geometry.boundingSphere || this.geometry.computeBoundingSphere(), this.boundRadius = a.boundingSphere.radius, this.geometry.morphTargets.length)) { this.morphTargetBase = -1, this.morphTargetForcedOrder = [], this.morphTargetInfluences = [], this.morphTargetDictionary = {}; for (var c = 0; c < this.geometry.morphTargets.length; c++) this.morphTargetInfluences.push(0), this.morphTargetDictionary[this.geometry.morphTargets[c].name] = c } }, THREE.Mesh.prototype = new THREE.Object3D, THREE.Mesh.prototype.constructor = THREE.Mesh, THREE.Mesh.prototype.supr = THREE.Object3D.prototype, THREE.Mesh.prototype.getMorphTargetIndexByName = function (a) { return void 0 !== this.morphTargetDictionary[a] ? this.morphTargetDictionary[a] : (console.log("THREE.Mesh.getMorphTargetIndexByName: morph target " + a + " does not exist. Returning 0."), 0) }, THREE.Bone = function (a) { THREE.Object3D.call(this), this.skin = a, this.skinMatrix = new THREE.Matrix4 }, THREE.Bone.prototype = new THREE.Object3D, THREE.Bone.prototype.constructor = THREE.Bone, THREE.Bone.prototype.supr = THREE.Object3D.prototype, THREE.Bone.prototype.update = function (a, b) { this.matrixAutoUpdate && (b |= this.updateMatrix()), (b || this.matrixWorldNeedsUpdate) && (a ? this.skinMatrix.multiply(a, this.matrix) : this.skinMatrix.copy(this.matrix), this.matrixWorldNeedsUpdate = !1, b = !0); var c, d = this.children.length; for (c = 0; d > c; c++) this.children[c].update(this.skinMatrix, b) }, THREE.Sprite = function (a) { THREE.Object3D.call(this), this.color = void 0 !== a.color ? new THREE.Color(a.color) : new THREE.Color(16777215), this.map = a.map instanceof THREE.Texture ? a.map : THREE.ImageUtils.loadTexture(a.map), this.blending = void 0 !== a.blending ? a.blending : THREE.NormalBlending, this.useScreenCoordinates = void 0 !== a.useScreenCoordinates ? a.useScreenCoordinates : !0, this.mergeWith3D = void 0 !== a.mergeWith3D ? a.mergeWith3D : !this.useScreenCoordinates, this.affectedByDistance = void 0 !== a.affectedByDistance ? a.affectedByDistance : !this.useScreenCoordinates, this.scaleByViewport = void 0 !== a.scaleByViewport ? a.scaleByViewport : !this.affectedByDistance, this.alignment = a.alignment instanceof THREE.Vector2 ? a.alignment : THREE.SpriteAlignment.center, this.rotation3d = this.rotation, this.rotation = 0, this.opacity = 1, this.uvOffset = new THREE.Vector2(0, 0), this.uvScale = new THREE.Vector2(1, 1) }, THREE.Sprite.prototype = new THREE.Object3D, THREE.Sprite.prototype.constructor = THREE.Sprite, THREE.Sprite.prototype.updateMatrix = function () { this.matrix.setPosition(this.position), this.rotation3d.set(0, 0, this.rotation), this.matrix.setRotationFromEuler(this.rotation3d), (1 !== this.scale.x || 1 !== this.scale.y) && (this.matrix.scale(this.scale), this.boundRadiusScale = Math.max(this.scale.x, this.scale.y)), this.matrixWorldNeedsUpdate = !0 }, THREE.SpriteAlignment = {}, THREE.SpriteAlignment.topLeft = new THREE.Vector2(1, -1), THREE.SpriteAlignment.topCenter = new THREE.Vector2(0, -1), THREE.SpriteAlignment.topRight = new THREE.Vector2(-1, -1), THREE.SpriteAlignment.centerLeft = new THREE.Vector2(1, 0), THREE.SpriteAlignment.center = new THREE.Vector2(0, 0), THREE.SpriteAlignment.centerRight = new THREE.Vector2(-1, 0), THREE.SpriteAlignment.bottomLeft = new THREE.Vector2(1, 1), THREE.SpriteAlignment.bottomCenter = new THREE.Vector2(0, 1), THREE.SpriteAlignment.bottomRight = new THREE.Vector2(-1, 1), THREE.Scene = function () { THREE.Object3D.call(this), this.overrideMaterial = this.fog = null, this.matrixAutoUpdate = !1, this.objects = [], this.lights = [], this.__objectsAdded = [], this.__objectsRemoved = [] }, THREE.Scene.prototype = new THREE.Object3D, THREE.Scene.prototype.constructor = THREE.Scene, THREE.Scene.prototype.addObject = function (a) { if (a instanceof THREE.Light) -1 === this.lights.indexOf(a) && this.lights.push(a); else if (!(a instanceof THREE.Camera || a instanceof THREE.Bone) && -1 === this.objects.indexOf(a)) { this.objects.push(a), this.__objectsAdded.push(a); var b = this.__objectsRemoved.indexOf(a); -1 !== b && this.__objectsRemoved.splice(b, 1) } for (b = 0; b < a.children.length; b++) this.addObject(a.children[b]) }, THREE.Scene.prototype.removeObject = function (a) { if (a instanceof THREE.Light) { var b = this.lights.indexOf(a); -1 !== b && this.lights.splice(b, 1) } else a instanceof THREE.Camera || (b = this.objects.indexOf(a), -1 !== b && (this.objects.splice(b, 1), this.__objectsRemoved.push(a), b = this.__objectsAdded.indexOf(a), -1 !== b && this.__objectsAdded.splice(b, 1))); for (b = 0; b < a.children.length; b++) this.removeObject(a.children[b]) }, THREE.CanvasRenderer = function (a) { function b(a) { Y != a && (V.globalAlpha = Y = a) } function c(a) { if (Z != a) { switch (a) { case THREE.NormalBlending: V.globalCompositeOperation = "source-over"; break; case THREE.AdditiveBlending: V.globalCompositeOperation = "lighter"; break; case THREE.SubtractiveBlending: V.globalCompositeOperation = "darker" } Z = a } } function d(a) { $ != a && (V.strokeStyle = $ = a) } function e(a) { _ != a && (V.fillStyle = _ = a) } var f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S = this, T = new THREE.Projector, a = a || {}, U = void 0 !== a.canvas ? a.canvas : document.createElement("canvas"), V = U.getContext("2d"), W = new THREE.Color(0), X = 0, Y = 1, Z = 0, $ = null, _ = null, ab = null, bb = null, cb = null, db = new THREE.RenderableVertex, eb = new THREE.RenderableVertex, fb = new THREE.Color, gb = new THREE.Color, hb = new THREE.Color, ib = new THREE.Color, jb = new THREE.Color, kb = [], lb = [], mb = new THREE.Rectangle, nb = new THREE.Rectangle, ob = new THREE.Rectangle, pb = !1, qb = new THREE.Color, rb = new THREE.Color, sb = new THREE.Color, tb = new THREE.Vector3, a = 16; M = document.createElement("canvas"), M.width = M.height = 2, N = M.getContext("2d"), N.fillStyle = "rgba(0,0,0,1)", N.fillRect(0, 0, 2, 2), O = N.getImageData(0, 0, 2, 2), P = O.data, Q = document.createElement("canvas"), Q.width = Q.height = a, R = Q.getContext("2d"), R.translate(-a / 2, -a / 2), R.scale(a, a), a--, this.domElement = U, this.sortElements = this.sortObjects = this.autoClear = !0, this.info = { render: { vertices: 0, faces: 0 } }, this.setSize = function (a, b) { i = a, j = b, k = Math.floor(i / 2), l = Math.floor(j / 2), U.width = i, U.height = j, mb.set(-k, -l, k, l), nb.set(-k, -l, k, l), Y = 1, Z = 0, cb = bb = ab = _ = $ = null }, this.setClearColor = function (a, b) { W.copy(a), X = b, nb.set(-k, -l, k, l) }, this.setClearColorHex = function (a, b) { W.setHex(a), X = b, nb.set(-k, -l, k, l) }, this.clear = function () { V.setTransform(1, 0, 0, -1, k, l), nb.isEmpty() || (nb.minSelf(mb), nb.inflate(2), 1 > X && V.clearRect(Math.floor(nb.getX()), Math.floor(nb.getY()), Math.floor(nb.getWidth()), Math.floor(nb.getHeight())), X > 0 && (c(THREE.NormalBlending), b(1), e("rgba(" + Math.floor(255 * W.r) + "," + Math.floor(255 * W.g) + "," + Math.floor(255 * W.b) + "," + X + ")"), V.fillRect(Math.floor(nb.getX()), Math.floor(nb.getY()), Math.floor(nb.getWidth()), Math.floor(nb.getHeight()))), nb.empty()) }, this.render = function (a, i) { function j(a) { var b, c, d, e; for (qb.setRGB(0, 0, 0), rb.setRGB(0, 0, 0), sb.setRGB(0, 0, 0), b = 0, c = a.length; c > b; b++) d = a[b], e = d.color, d instanceof THREE.AmbientLight ? (qb.r += e.r, qb.g += e.g, qb.b += e.b) : d instanceof THREE.DirectionalLight ? (rb.r += e.r, rb.g += e.g, rb.b += e.b) : d instanceof THREE.PointLight && (sb.r += e.r, sb.g += e.g, sb.b += e.b) } function U(a, b, c, d) { var e, f, g, h, i, j; for (e = 0, f = a.length; f > e; e++) g = a[e], h = g.color, g instanceof THREE.DirectionalLight ? (i = g.matrixWorld.getPosition(), j = c.dot(i), 0 >= j || (j *= g.intensity, d.r += h.r * j, d.g += h.g * j, d.b += h.b * j)) : g instanceof THREE.PointLight && (i = g.matrixWorld.getPosition(), j = c.dot(tb.sub(i, b).normalize()), 0 >= j || (j *= 0 == g.distance ? 1 : 1 - Math.min(b.distanceTo(i) / g.distance, 1), 0 != j && (j *= g.intensity, d.r += h.r * j, d.g += h.g * j, d.b += h.b * j))) } function W(a, f, g) { b(g.opacity), c(g.blending); var h, i, j, m, n, o; g instanceof THREE.ParticleBasicMaterial ? g.map && (m = g.map.image, n = m.width >> 1, o = m.height >> 1, g = f.scale.x * k, j = f.scale.y * l, h = g * n, i = j * o, ob.set(a.x - h, a.y - i, a.x + h, a.y + i), mb.intersects(ob) && (V.save(), V.translate(a.x, a.y), V.rotate(-f.rotation), V.scale(g, -j), V.translate(-n, -o), V.drawImage(m, 0, 0), V.restore())) : g instanceof THREE.ParticleCanvasMaterial && (h = f.scale.x * k, i = f.scale.y * l, ob.set(a.x - h, a.y - i, a.x + h, a.y + i), mb.intersects(ob) && (d(g.color.getContextStyle()), e(g.color.getContextStyle()), V.save(), V.translate(a.x, a.y), V.rotate(-f.rotation), V.scale(h, i), g.program(V), V.restore())) } function X(a, e, f, g) { b(g.opacity), c(g.blending), V.beginPath(), V.moveTo(a.positionScreen.x, a.positionScreen.y), V.lineTo(e.positionScreen.x, e.positionScreen.y), V.closePath(), g instanceof THREE.LineBasicMaterial && (a = g.linewidth, ab != a && (V.lineWidth = ab = a), a = g.linecap, bb != a && (V.lineCap = bb = a), a = g.linejoin, cb != a && (V.lineJoin = cb = a), d(g.color.getContextStyle()), V.stroke(), ob.inflate(2 * g.linewidth)) } function Y(a, d, e, f, g, j, k, l) { S.info.render.vertices += 3, S.info.render.faces++, b(l.opacity), c(l.blending), q = a.positionScreen.x, r = a.positionScreen.y, s = d.positionScreen.x, t = d.positionScreen.y, u = e.positionScreen.x, v = e.positionScreen.y, $(q, r, s, t, u, v), l instanceof THREE.MeshBasicMaterial ? l.map ? l.map.mapping instanceof THREE.UVMapping && (F = k.uvs[0], wb(q, r, s, t, u, v, F[f].u, F[f].v, F[g].u, F[g].v, F[j].u, F[j].v, l.map)) : l.envMap ? l.envMap.mapping instanceof THREE.SphericalReflectionMapping && (a = i.matrixWorldInverse, tb.copy(k.vertexNormalsWorld[f]), G = .5 * (tb.x * a.n11 + tb.y * a.n12 + tb.z * a.n13) + .5, H = .5 * -(tb.x * a.n21 + tb.y * a.n22 + tb.z * a.n23) + .5, tb.copy(k.vertexNormalsWorld[g]), I = .5 * (tb.x * a.n11 + tb.y * a.n12 + tb.z * a.n13) + .5, J = .5 * -(tb.x * a.n21 + tb.y * a.n22 + tb.z * a.n23) + .5, tb.copy(k.vertexNormalsWorld[j]), K = .5 * (tb.x * a.n11 + tb.y * a.n12 + tb.z * a.n13) + .5, L = .5 * -(tb.x * a.n21 + tb.y * a.n22 + tb.z * a.n23) + .5, wb(q, r, s, t, u, v, G, H, I, J, K, L, l.envMap)) : l.wireframe ? ub(l.color, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(l.color) : l instanceof THREE.MeshLambertMaterial ? (l.map && !l.wireframe && (l.map.mapping instanceof THREE.UVMapping && (F = k.uvs[0], wb(q, r, s, t, u, v, F[f].u, F[f].v, F[g].u, F[g].v, F[j].u, F[j].v, l.map)), c(THREE.SubtractiveBlending)), pb ? l.wireframe || l.shading != THREE.SmoothShading || 3 != k.vertexNormalsWorld.length ? (fb.r = qb.r, fb.g = qb.g, fb.b = qb.b, U(h, k.centroidWorld, k.normalWorld, fb), fb.r = Math.max(0, Math.min(l.color.r * fb.r, 1)), fb.g = Math.max(0, Math.min(l.color.g * fb.g, 1)), fb.b = Math.max(0, Math.min(l.color.b * fb.b, 1)), l.wireframe ? ub(fb, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(fb)) : (gb.r = hb.r = ib.r = qb.r, gb.g = hb.g = ib.g = qb.g, gb.b = hb.b = ib.b = qb.b, U(h, k.v1.positionWorld, k.vertexNormalsWorld[0], gb), U(h, k.v2.positionWorld, k.vertexNormalsWorld[1], hb), U(h, k.v3.positionWorld, k.vertexNormalsWorld[2], ib), gb.r = Math.max(0, Math.min(l.color.r * gb.r, 1)), gb.g = Math.max(0, Math.min(l.color.g * gb.g, 1)), gb.b = Math.max(0, Math.min(l.color.b * gb.b, 1)), hb.r = Math.max(0, Math.min(l.color.r * hb.r, 1)), hb.g = Math.max(0, Math.min(l.color.g * hb.g, 1)), hb.b = Math.max(0, Math.min(l.color.b * hb.b, 1)), ib.r = Math.max(0, Math.min(l.color.r * ib.r, 1)), ib.g = Math.max(0, Math.min(l.color.g * ib.g, 1)), ib.b = Math.max(0, Math.min(l.color.b * ib.b, 1)), jb.r = .5 * (hb.r + ib.r), jb.g = .5 * (hb.g + ib.g), jb.b = .5 * (hb.b + ib.b), E = yb(gb, hb, ib, jb), xb(q, r, s, t, u, v, 0, 0, 1, 0, 0, 1, E)) : l.wireframe ? ub(l.color, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(l.color)) : l instanceof THREE.MeshDepthMaterial ? (C = i.near, D = i.far, gb.r = gb.g = gb.b = 1 - zb(a.positionScreen.z, C, D), hb.r = hb.g = hb.b = 1 - zb(d.positionScreen.z, C, D), ib.r = ib.g = ib.b = 1 - zb(e.positionScreen.z, C, D), jb.r = .5 * (hb.r + ib.r), jb.g = .5 * (hb.g + ib.g), jb.b = .5 * (hb.b + ib.b), E = yb(gb, hb, ib, jb), xb(q, r, s, t, u, v, 0, 0, 1, 0, 0, 1, E)) : l instanceof THREE.MeshNormalMaterial && (fb.r = Ab(k.normalWorld.x), fb.g = Ab(k.normalWorld.y), fb.b = Ab(k.normalWorld.z), l.wireframe ? ub(fb, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(fb)) } function Z(a, d, e, f, g, j, k, l, m) { S.info.render.vertices += 4, S.info.render.faces++, b(l.opacity), c(l.blending), l.map || l.envMap ? (Y(a, d, f, 0, 1, 3, k, l, m), Y(g, e, j, 1, 2, 3, k, l, m)) : (q = a.positionScreen.x, r = a.positionScreen.y, s = d.positionScreen.x, t = d.positionScreen.y, u = e.positionScreen.x, v = e.positionScreen.y, w = f.positionScreen.x, x = f.positionScreen.y, y = g.positionScreen.x, z = g.positionScreen.y, A = j.positionScreen.x, B = j.positionScreen.y, l instanceof THREE.MeshBasicMaterial ? (_(q, r, s, t, u, v, w, x), l.wireframe ? ub(l.color, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(l.color)) : l instanceof THREE.MeshLambertMaterial ? pb ? l.wireframe || l.shading != THREE.SmoothShading || 4 != k.vertexNormalsWorld.length ? (fb.r = qb.r, fb.g = qb.g, fb.b = qb.b, U(h, k.centroidWorld, k.normalWorld, fb), fb.r = Math.max(0, Math.min(l.color.r * fb.r, 1)), fb.g = Math.max(0, Math.min(l.color.g * fb.g, 1)), fb.b = Math.max(0, Math.min(l.color.b * fb.b, 1)), _(q, r, s, t, u, v, w, x), l.wireframe ? ub(fb, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(fb)) : (gb.r = hb.r = ib.r = jb.r = qb.r, gb.g = hb.g = ib.g = jb.g = qb.g, gb.b = hb.b = ib.b = jb.b = qb.b, U(h, k.v1.positionWorld, k.vertexNormalsWorld[0], gb), U(h, k.v2.positionWorld, k.vertexNormalsWorld[1], hb), U(h, k.v4.positionWorld, k.vertexNormalsWorld[3], ib), U(h, k.v3.positionWorld, k.vertexNormalsWorld[2], jb), gb.r = Math.max(0, Math.min(l.color.r * gb.r, 1)), gb.g = Math.max(0, Math.min(l.color.g * gb.g, 1)), gb.b = Math.max(0, Math.min(l.color.b * gb.b, 1)), hb.r = Math.max(0, Math.min(l.color.r * hb.r, 1)), hb.g = Math.max(0, Math.min(l.color.g * hb.g, 1)), hb.b = Math.max(0, Math.min(l.color.b * hb.b, 1)), ib.r = Math.max(0, Math.min(l.color.r * ib.r, 1)), ib.g = Math.max(0, Math.min(l.color.g * ib.g, 1)), ib.b = Math.max(0, Math.min(l.color.b * ib.b, 1)), jb.r = Math.max(0, Math.min(l.color.r * jb.r, 1)), jb.g = Math.max(0, Math.min(l.color.g * jb.g, 1)), jb.b = Math.max(0, Math.min(l.color.b * jb.b, 1)), E = yb(gb, hb, ib, jb), $(q, r, s, t, w, x), xb(q, r, s, t, w, x, 0, 0, 1, 0, 0, 1, E), $(y, z, u, v, A, B), xb(y, z, u, v, A, B, 1, 0, 1, 1, 0, 1, E)) : (_(q, r, s, t, u, v, w, x), l.wireframe ? ub(l.color, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(l.color)) : l instanceof THREE.MeshNormalMaterial ? (fb.r = Ab(k.normalWorld.x), fb.g = Ab(k.normalWorld.y), fb.b = Ab(k.normalWorld.z), _(q, r, s, t, u, v, w, x), l.wireframe ? ub(fb, l.wireframeLinewidth, l.wireframeLinecap, l.wireframeLinejoin) : vb(fb)) : l instanceof THREE.MeshDepthMaterial && (C = i.near, D = i.far, gb.r = gb.g = gb.b = 1 - zb(a.positionScreen.z, C, D), hb.r = hb.g = hb.b = 1 - zb(d.positionScreen.z, C, D), ib.r = ib.g = ib.b = 1 - zb(f.positionScreen.z, C, D), jb.r = jb.g = jb.b = 1 - zb(e.positionScreen.z, C, D), E = yb(gb, hb, ib, jb), $(q, r, s, t, w, x), xb(q, r, s, t, w, x, 0, 0, 1, 0, 0, 1, E), $(y, z, u, v, A, B), xb(y, z, u, v, A, B, 1, 0, 1, 1, 0, 1, E))) } function $(a, b, c, d, e, f) { V.beginPath(), V.moveTo(a, b), V.lineTo(c, d), V.lineTo(e, f), V.lineTo(a, b), V.closePath() } function _(a, b, c, d, e, f, g, h) { V.beginPath(), V.moveTo(a, b), V.lineTo(c, d), V.lineTo(e, f), V.lineTo(g, h), V.lineTo(a, b), V.closePath() } function ub(a, b, c, e) { ab != b && (V.lineWidth = ab = b), bb != c && (V.lineCap = bb = c), cb != e && (V.lineJoin = cb = e), d(a.getContextStyle()), V.stroke(), ob.inflate(2 * b) } function vb(a) { e(a.getContextStyle()), V.fill() } function wb(a, b, c, d, f, g, h, i, j, k, l, m, n) { if (0 != n.image.width) { if (1 == n.needsUpdate || void 0 == kb[n.id]) { var o = n.wrapS == THREE.RepeatWrapping, p = n.wrapT == THREE.RepeatWrapping; kb[n.id] = V.createPattern(n.image, o && p ? "repeat" : o && !p ? "repeat-x" : !o && p ? "repeat-y" : "no-repeat"), n.needsUpdate = !1 } e(kb[n.id]); var o = n.offset.x / n.repeat.x, p = n.offset.y / n.repeat.y, q = n.image.width * n.repeat.x, r = n.image.height * n.repeat.y, h = (h + o) * q, i = (i + p) * r, j = (j + o) * q, k = (k + p) * r, l = (l + o) * q, m = (m + p) * r; c -= a, d -= b, f -= a, g -= b, j -= h, k -= i, l -= h, m -= i, o = j * m - l * k, 0 == o ? (void 0 == lb[n.id] && (b = document.createElement("canvas"), b.width = n.image.width, b.height = n.image.height, a = b.getContext("2d"), a.drawImage(n.image, 0, 0), lb[n.id] = a.getImageData(0, 0, n.image.width, n.image.height).data, delete b), b = lb[n.id], h = 4 * (Math.floor(h) + Math.floor(i) * n.image.width), fb.setRGB(b[h] / 255, b[h + 1] / 255, b[h + 2] / 255), vb(fb)) : (o = 1 / o, n = (m * c - k * f) * o, k = (m * d - k * g) * o, c = (j * f - l * c) * o, d = (j * g - l * d) * o, a = a - n * h - c * i, h = b - k * h - d * i, V.save(), V.transform(n, k, c, d, a, h), V.fill(), V.restore()) } } function xb(a, b, c, d, e, f, g, h, i, j, k, l, m) { var n, o; n = m.width - 1, o = m.height - 1, g *= n, h *= o, i *= n, j *= o, k *= n, l *= o, c -= a, d -= b, e -= a, f -= b, i -= g, j -= h, k -= g, l -= h, o = 1 / (i * l - k * j), n = (l * c - j * e) * o, j = (l * d - j * f) * o, c = (i * e - k * c) * o, d = (i * f - k * d) * o, a = a - n * g - c * h, b = b - j * g - d * h, V.save(), V.transform(n, j, c, d, a, b), V.clip(), V.drawImage(m, 0, 0), V.restore() } function yb(a, b, c, d) { var e = ~~(255 * a.r), f = ~~(255 * a.g), a = ~~(255 * a.b), g = ~~(255 * b.r), h = ~~(255 * b.g), b = ~~(255 * b.b), i = ~~(255 * c.r), j = ~~(255 * c.g), c = ~~(255 * c.b), k = ~~(255 * d.r), l = ~~(255 * d.g), d = ~~(255 * d.b); return P[0] = 0 > e ? 0 : e > 255 ? 255 : e, P[1] = 0 > f ? 0 : f > 255 ? 255 : f, P[2] = 0 > a ? 0 : a > 255 ? 255 : a, P[4] = 0 > g ? 0 : g > 255 ? 255 : g, P[5] = 0 > h ? 0 : h > 255 ? 255 : h, P[6] = 0 > b ? 0 : b > 255 ? 255 : b, P[8] = 0 > i ? 0 : i > 255 ? 255 : i, P[9] = 0 > j ? 0 : j > 255 ? 255 : j, P[10] = 0 > c ? 0 : c > 255 ? 255 : c, P[12] = 0 > k ? 0 : k > 255 ? 255 : k, P[13] = 0 > l ? 0 : l > 255 ? 255 : l, P[14] = 0 > d ? 0 : d > 255 ? 255 : d, N.putImageData(O, 0, 0), R.drawImage(M, 0, 0), Q } function zb(a, b, c) { return a = (a - b) / (c - b), a * a * (3 - 2 * a) } function Ab(a) { return a = .5 * (a + 1), 0 > a ? 0 : a > 1 ? 1 : a } function Bb(a, b) { var c = b.x - a.x, d = b.y - a.y, e = c * c + d * d; 0 != e && (e = 1 / Math.sqrt(e), c *= e, d *= e, b.x += c, b.y += d, a.x -= c, a.y -= d) } var Cb, Db, Eb, Fb; for (this.autoClear ? this.clear() : V.setTransform(1, 0, 0, -1, k, l), S.info.render.vertices = 0, S.info.render.faces = 0, f = T.projectScene(a, i, this.sortElements), g = f.elements, h = f.lights, (pb = h.length > 0) && j(h), Cb = 0, Db = g.length; Db > Cb; Cb++) Eb = g[Cb], Fb = Eb.material, Fb = Fb instanceof THREE.MeshFaceMaterial ? Eb.faceMaterial : Fb, null == Fb || 0 == Fb.opacity || (ob.empty(), Eb instanceof THREE.RenderableParticle ? (m = Eb, m.x *= k, m.y *= l, W(m, Eb, Fb, a)) : Eb instanceof THREE.RenderableLine ? (m = Eb.v1, n = Eb.v2, m.positionScreen.x *= k, m.positionScreen.y *= l, n.positionScreen.x *= k, n.positionScreen.y *= l, ob.addPoint(m.positionScreen.x, m.positionScreen.y), ob.addPoint(n.positionScreen.x, n.positionScreen.y), mb.intersects(ob) && X(m, n, Eb, Fb, a)) : Eb instanceof THREE.RenderableFace3 ? (m = Eb.v1, n = Eb.v2, o = Eb.v3, m.positionScreen.x *= k, m.positionScreen.y *= l, n.positionScreen.x *= k, n.positionScreen.y *= l, o.positionScreen.x *= k, o.positionScreen.y *= l, Fb.overdraw && (Bb(m.positionScreen, n.positionScreen), Bb(n.positionScreen, o.positionScreen), Bb(o.positionScreen, m.positionScreen)), ob.add3Points(m.positionScreen.x, m.positionScreen.y, n.positionScreen.x, n.positionScreen.y, o.positionScreen.x, o.positionScreen.y), mb.intersects(ob) && Y(m, n, o, 0, 1, 2, Eb, Fb, a)) : Eb instanceof THREE.RenderableFace4 && (m = Eb.v1, n = Eb.v2, o = Eb.v3, p = Eb.v4, m.positionScreen.x *= k, m.positionScreen.y *= l, n.positionScreen.x *= k, n.positionScreen.y *= l, o.positionScreen.x *= k, o.positionScreen.y *= l, p.positionScreen.x *= k, p.positionScreen.y *= l, db.positionScreen.copy(n.positionScreen), eb.positionScreen.copy(p.positionScreen), Fb.overdraw && (Bb(m.positionScreen, n.positionScreen), Bb(n.positionScreen, p.positionScreen), Bb(p.positionScreen, m.positionScreen), Bb(o.positionScreen, db.positionScreen), Bb(o.positionScreen, eb.positionScreen)), ob.addPoint(m.positionScreen.x, m.positionScreen.y), ob.addPoint(n.positionScreen.x, n.positionScreen.y), ob.addPoint(o.positionScreen.x, o.positionScreen.y), ob.addPoint(p.positionScreen.x, p.positionScreen.y), mb.intersects(ob) && Z(m, n, o, p, db, eb, Eb, Fb, a)), nb.addRectangle(ob)); V.setTransform(1, 0, 0, 1, 0, 0) } }, THREE.RenderableVertex = function () { this.positionWorld = new THREE.Vector3, this.positionScreen = new THREE.Vector4, this.visible = !0 }, THREE.RenderableVertex.prototype.copy = function (a) { this.positionWorld.copy(a.positionWorld), this.positionScreen.copy(a.positionScreen) }, THREE.RenderableFace3 = function () { this.v1 = new THREE.RenderableVertex, this.v2 = new THREE.RenderableVertex, this.v3 = new THREE.RenderableVertex, this.centroidWorld = new THREE.Vector3, this.centroidScreen = new THREE.Vector3, this.normalWorld = new THREE.Vector3, this.vertexNormalsWorld = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3], this.faceMaterial = this.material = null, this.uvs = [[]], this.z = null }, THREE.RenderableFace4 = function () { this.v1 = new THREE.RenderableVertex, this.v2 = new THREE.RenderableVertex, this.v3 = new THREE.RenderableVertex, this.v4 = new THREE.RenderableVertex, this.centroidWorld = new THREE.Vector3, this.centroidScreen = new THREE.Vector3, this.normalWorld = new THREE.Vector3, this.vertexNormalsWorld = [new THREE.Vector3, new THREE.Vector3, new THREE.Vector3, new THREE.Vector3], this.faceMaterial = this.material = null, this.uvs = [[]], this.z = null }, THREE.RenderableObject = function () { this.z = this.object = null }, THREE.RenderableParticle = function () { this.rotation = this.z = this.y = this.x = null, this.scale = new THREE.Vector2, this.material = null }, THREE.RenderableLine = function () { this.z = null, this.v1 = new THREE.RenderableVertex, this.v2 = new THREE.RenderableVertex, this.material = null }; var THREEx = THREEx || {}; THREEx.WindowResize = function (a, b) { var c = function () { a.setSize(window.innerWidth, window.innerHeight), b.aspect = window.innerWidth / window.innerHeight, b.updateProjectionMatrix() }; return window.addEventListener("resize", c, !1), { stop: function () { window.removeEventListener("resize", c) } } }, !function (a) { "use strict"; a.html5Loader = function (b) { var c = { filesToLoad: null, debugMode: !1, onBeforeLoad: function () { }, onComplete: function () { }, onElementLoaded: function () { }, onUpdate: function () { }, onMediaError: function () { } }, d = a.extend(c, b), e = d.filesToLoad, f = d.debugMode, g = d.onBeforeLoad, h = d.onComplete, i = d.onElementLoaded, j = d.onUpdate, k = d.onMediaError, l = (a(window), a("body"), a("head")), m = 0, n = 0, o = [], p = navigator.userAgent.match(/iPad/i), q = function (a) { return /android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|meego.+mobile|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4)) ? !0 : !1 }(navigator.userAgent || navigator.vendor || window.opera), r = {}, s = function (a) { f && console && console.log(a) }; r.video = function () { var a = document.createElement("video"), b = !1; try { (b = !!a.canPlayType) && (b = new Boolean(b), b.ogg = a.canPlayType('video/ogg; codecs="theora"'), b.mp4 = b.h264 = a.canPlayType('video/mp4; codecs="avc1.42E01E"'), b.webm = a.canPlayType('video/webm; codecs="vp8, vorbis"')) } catch (c) { } return b }(), r.audio = function () { var a = document.createElement("audio"), b = !1; try { (b = !!a.canPlayType) && (b = new Boolean(b), b.ogg = a.canPlayType('audio/ogg; codecs="vorbis"'), b.mp3 = a.canPlayType("audio/mpeg;"), b.wav = a.canPlayType('audio/wav; codecs="1"'), b.m4a = a.canPlayType("audio/x-m4a;") || a.canPlayType("audio/aac;")) } catch (c) { } return b }(); var t = function (b) { var c = b.type.toLowerCase(), d = b.sources; return a.each(d, function (a) { return r[c][a] ? (b = b.sources[a], b.type = c.toUpperCase(), !1) : void 0 }), b.source ? b : !1 }, u = function () { var a = 0; s("_bytesTotal = " + n), s("_bytesLoaded = " + m), a = Math.round(100 * (m / n)), s("Percentage: " + a + "%"), j(a), o.length || h() }, v = function (a, b) { var c = b; ("VIDEO" === c.type || "AUDIO" === c.type) && (c = t(c)), c && (n += c.size, o.push(c)) }, w = function (b) { s("json loaded"), a(b.files).each(v) }, x = function (b) { var c = new a.Deferred, d = b.size, e = a("<img>"); return a(e).on("load", function () { s("File Loaded:" + b.source), m += d, i(b, e[0]), e = null, o.splice(0, 1), u(), c.resolve() }), e.attr("src", b.source), c.promise() }, y = function (b) { var c = new a.Deferred, d = b.size, e = "VIDEO" === b.type ? a("<video></video>") : a("<audio></audio>"), f = function () { s("File Loaded:" + b.source), m += d, i(b, e[0]), o.splice(0, 1), e.off(), e = null, u(), c.resolve() }; return q || p ? f() : (e.on("loadstart", function () { 3 == this.networkState && (k(b, this), f()) }), e.on("error stalled", function () { k(b, this), f() }), e.on("loadedmetadata", function () { e.on("progress", function () { var a = 0; s("loading in progress file:" + b.source), this.buffered.length > 0 && (a = d / this.duration * this.buffered.end(0), d -= a, m += a, u()) }) }), e.on("canplaythrough load", f)), e.attr({ preload: "auto", src: b.source, controls: "controls" }), c.promise() }, z = function (b) { var c = new a.Deferred, d = b.size; return a.getScript(b.source, function (a) { s("File Loaded:" + b.source), m += d, i(b, a), o.splice(0, 1), u(), c.resolve() }), c.promise() }, A = function (b, c) { var d = new a.Deferred; return a.ajax({ url: b.source, dataType: "text", success: function (a) { if (s("File Loaded:" + b.source), i(b, a), m += b.size, o.splice(0, 1), u(), c) if (document.createStyleSheet) try { document.createStyleSheet(b.source) } catch (e) { } else { var f; f = document.createElement("link"), f.rel = "stylesheet", f.type = "text/css", f.media = "all", f.href = b.source, l[0].appendChild(f) } d.resolve(a) } }), d.promise() }, B = function () { var b = o.slice(); a.each(b, function (a, b) { switch (s("preloading files"), s("file to preload:" + b.source), b.type) { case "IMAGE": x(b); break; case "VIDEO": case "AUDIO": y(b); break; case "SCRIPT": z(b); break; case "TEXT": case "CSS": A(b, /CSS/g.test(b.type)); break; default: return !1 } }) }; return this.init = function () { s("plugin initialized"); var b = new a.Deferred, c = b.promise(); g(), "object" == typeof e ? (a.proxy(w, this, e)(), b.resolve(e)) : (a.getJSON(e, b.resolve), b.pipe(a.proxy(w, this))), c.then(a.proxy(u, this)), c.then(a.proxy(B, this)) }, this.init(), this } }(jQuery), function (a) { a.fn.textareaCount = function (b, c) { function d() { return p.html(e()), "undefined" != typeof c && c.call(this, g()), !0 } function e() { var a = n.val(), c = a.length; if (b.maxCharacterSize > 0) { c >= b.maxCharacterSize && (a = a.substring(0, b.maxCharacterSize)); var d = j(a), e = b.maxCharacterSize - d; if (i() || (e = b.maxCharacterSize), c > e) { var g = this.scrollTop; n.val(a.substring(0, e)), this.scrollTop = g } p.removeClass(b.warningStyle), e - c <= b.warningNumber && p.addClass(b.warningStyle), q = n.val().length + d, i() || (q = n.val().length), t = l(k(n.val())), s = r - q } else { var d = j(a); q = n.val().length + d, i() || (q = n.val().length), t = l(k(n.val())) } return f() } function f() { var a = b.displayFormat; return a = a.replace("#input", q), a = a.replace("#words", t), r > 0 && (a = a.replace("#max", r), a = a.replace("#left", s)), a } function g() { var a = { input: q, max: r, left: s, words: t }; return a } function h(a) { return a.next(".charleft") } function i() { var a = navigator.appVersion; return -1 != a.toLowerCase().indexOf("win") ? !0 : !1 } function j(a) { for (var b = 0, c = 0; c < a.length; c++) "\n" == a.charAt(c) && b++; return b } function k(a) { var b = a + " ", c = /^[^A-Za-z0-9]+/gi, d = b.replace(c, ""), e = rExp = /[^A-Za-z0-9]+/gi, f = d.replace(e, " "), g = f.split(" "); return g } function l(a) { var b = a.length - 1; return b } var m = { maxCharacterSize: -1, originalStyle: "originalTextareaInfo", warningStyle: "warningTextareaInfo", warningNumber: 20, displayFormat: "#input characters | #words words" }, b = a.extend(m, b), n = a(this); a("<div class='charleft'>&nbsp;</div>").insertAfter(n); var o = { width: n.width() }, p = h(n); p.addClass(b.originalStyle), p.css(o); var q = 0, r = b.maxCharacterSize, s = 0, t = 0; n.bind("keyup", function () { d() }).bind("mouseover", function () { setTimeout(function () { d() }, 10) }).bind("paste", function () { setTimeout(function () { d() }, 10) }) } }(jQuery), Particle3D = function (a) { THREE.Particle.call(this, a), this.velocity = new THREE.Vector3(0, -8, 0), this.velocity.rotateX(randomRange(-45, 45)), this.velocity.rotateY(randomRange(0, 360)), this.gravity = new THREE.Vector3(0, 0, 0), this.drag = 1 }, Particle3D.prototype = new THREE.Particle, Particle3D.prototype.constructor = Particle3D, Particle3D.prototype.updatePhysics = function () { this.velocity.multiplyScalar(this.drag), this.velocity.addSelf(this.gravity), this.position.addSelf(this.velocity) }; var TO_RADIANS = Math.PI / 180; THREE.Vector3.prototype.rotateY = function (a) { cosRY = Math.cos(a * TO_RADIANS), sinRY = Math.sin(a * TO_RADIANS); var b = this.z, c = this.x; this.x = c * cosRY + b * sinRY, this.z = c * -sinRY + b * cosRY }, THREE.Vector3.prototype.rotateX = function (a) {
    cosRY = Math.cos(a * TO_RADIANS), sinRY = Math.sin(a * TO_RADIANS); var b = this.z, c = this.y; this.y = c * cosRY + b * sinRY, this.z = c * -sinRY + b * cosRY
}, THREE.Vector3.prototype.rotateZ = function (a) { cosRY = Math.cos(a * TO_RADIANS), sinRY = Math.sin(a * TO_RADIANS); var b = this.x, c = this.y; this.y = c * cosRY + b * sinRY, this.x = c * -sinRY + b * cosRY }, function () { var a = document.createElement("audio"), b = document.createElement("audio"), c = document.createElement("audio"); window.canPlaySound = !0; var d = function () { window.canPlaySound = !window.canPlaySound, window.canPlaySound ? ($(".js-SoundToggle-status").addClass("is-on").removeClass("is-off"), e()) : ($(".js-SoundToggle-status").addClass("is-off").removeClass("is-on"), f()) }, e = function () { window.canPlaySound && a.play() }, f = function () { a.pause(), b.pause() }, g = function () { var a = document.createElement("audio"); return a.canPlayType ? "" != a.canPlayType("audio/mpeg") ? "mp3" : "" != a.canPlayType('audio/ogg; codecs="vorbis"') ? "ogg" : "" != a.canPlayType('audio/mp4; codecs="mp4a.40.5"') ? "acc" : void 0 : "none" }, h = function () { window.canPlaySound && c.play() }, i = function () { var d = g(); a.setAttribute("src", "audio/jd-ambience." + d), a.setAttribute("preload", "auto"), b.setAttribute("src", "audio/jd-trucks." + d), b.setAttribute("preload", "auto"), c.setAttribute("src", "audio/jd-door." + d), c.setAttribute("preload", "auto"), a.addEventListener("ended", function () { this.currentTime = 0, this.play() }, !1), b.addEventListener("ended", function () { a.play() }, !1), $(a).appendTo("body"), $(b).appendTo("body"), $(c).appendTo("body") }, j = function () { window.canPlaySound && setTimeout(function () { b.play() }, 300) }; $(window).on("playDoorOpenSound", h), $(window).on("playHomepageSound", j), $(window).on("initialiseAudio", i), $(window).on("playSound", e), $(window).on("stopSound", f), $(".js-soundToggle").click(d) }(); var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight, container, particle, camera, scene, renderer, particles = [], particleImage = new Image; particleImage.src = "http://www.reklam5.com/App_Themes/Default/images/ParticleSmoke.png", $(window).on("initialiseSnow", initialiseSnow), function () { jQuery.validator.addMethod("wordCount", function (a, b, c) { for (var d = $.trim(a).split(" "), e = d, f = d.length - 1; f >= 0; f--) { var g = $.trim(d[f]); g.length < 1 && e.splice(f, 1) } var h = e.length; return h <= c[0] ? !0 : void 0 }, jQuery.format("Only {0} words allowed.")), jQuery.validator.addMethod("RequiredBirthdate", function () { var a = !1; return "" !== $("input[name*='[dob][day]']").val() && "" !== $("input[name*='[dob][month]']").val() && "" !== $("input[name*='dob][year]']").val() && (a = !0), a }, "Please enter your Date of Birth"), jQuery.validator.addMethod("ValidDate", function () { var a = !1; if ("" !== $("input[name*='[dob][month]']").val() && "" !== $("input[name*='[dob][day]']").val() && "" !== $("input[name*='dob][year]']").val()) { var b = parseInt($("input[name*='[dob][day]']").val(), 10), c = parseInt($("input[name*='[dob][month]']").val(), 10), d = parseInt($("input[name*='dob][year]']").val(), 10), e = new Date(d, c - 1, b); a = c - 1 == e.getMonth() && b == e.getDate() && d == e.getFullYear() } return a }, "Please enter a valid Date"), jQuery.validator.addMethod("ValidAge", function () { var a = !0; if ("" !== $("input[name*='[dob][month]']").val() && "" !== $("input[name*='[dob][day]']").val() && "" !== $("input[name*='dob][year]']").val()) { var b = parseInt($("input[name*='[dob][day]']").val(), 10), c = parseInt($("input[name*='[dob][month]']").val(), 10), d = parseInt($("input[name*='dob][year]']").val(), 10), e = new Date(d, c - 1, b), f = new Date; f.setFullYear(f.getFullYear() - 18), a = f - e >= 0 } return a }, "You need to be 18 or older to enter the competition"); var a = function () { $("#form_answer").textareaCount({ originalStyle: "originalDisplayInfo", warningStyle: "is-warning", displayFormat: " " }, function (a) { var b = 25 - a.words, c = 0 > b; $("#form_answer").closest(".Control").toggleClass("is-invalid", c), $(".js-CompetitionSubmissionForm .charleft").text(b) }), $(".js-CompetitionSubmissionForm").validate({ rules: { "form[answer]": { required: !0, wordCount: ["25"] }, "form[first_name1]": { required: !0 }, "form[last_name1]": { required: !0 }, "form[email]": { required: !0, email: !0 }, "form[cell_phone]": { required: !0 }, "form[address1]": { required: !0 }, "form[state_prov_terr]": { required: !0 }, "form[city]": { required: !0 }, "form[zip]": { required: !0, minlength: 3, number: !0 }, "form[dob][day]": { RequiredBirthdate: !0, ValidDate: !0, ValidAge: !0 }, "form[dob][month]": { RequiredBirthdate: !0, ValidDate: !0, ValidAge: !0 }, "form[dob][year]": { RequiredBirthdate: !0, ValidDate: !0, ValidAge: !0, minlength: 4 }, "form[agree_terms]": { required: !0 } }, messages: { "form[answer]": { required: "Please teel us who you would share a bottle of Holiday Select with", wordCount: "Please answer in 25 words or less" }, "form[first_name1]": { required: "Please enter your first name" }, "form[last_name1]": { required: "Please enter your last name" }, "form[email]": { required: "Please enter your email address", email: "Please enter a valid email addres" }, "form[cell_phone]": { required: "Please enter your phone number" }, "form[address1]": { required: "Please enter your address" }, "form[state_prov_terr]": { required: "Please enter your state" }, "form[city]": { required: "Please enter your C=city" }, "form[zip]": { required: "Please enter your postcode", minlength: "Your postcode must be four digits", number: "Your postcode should be numerical" }, "form[dob][day]": { RequiredBirthdate: "Please enter your Date of Birth", ValidDate: "Please enter a valid Date", ValidAge: "You need to be 18 or older to enter the competition" }, "form[dob][month]": { RequiredBirthdate: "Please enter your Date of Birth", ValidDate: "Please enter a valid Date", ValidAge: "You need to be 18 or older to enter the competition" }, "form[dob][year]": { RequiredBirthdate: "Please enter your Date of Birth", ValidDate: "Please enter a valid Date", ValidAge: "You need to be 18 or older to enter the competition", minlength: "Please enter all four digits for your birth year" }, "form[agree_terms]": { required: "Please agree to the terms and conditions" } }, highlight: function (a) { $(a).closest(".Control").addClass("is-invalid") }, unhighlight: function (a) { $(a).closest(".Control").removeClass("is-invalid") }, errorPlacement: function () { }, submitHandler: function () { return $button = $(".js-validateCpmetitionForm"), $button.text("Sending").addClass("is-disabled"), $.ajax({ type: "POST", url: "barrel-tree/competition", data: $(".js-CompetitionSubmissionForm").serialize(), success: function (a) { $returned = $(a), $returned.find(".js-CompetitionSubmissionReceived").length ? $(".js-CompetitionSuccessful").fadeOut(300, function () { $(this).html($returned).fadeIn(300, function () { $(window).trigger("checkScrollboxSize"), $(window).trigger("linkLikeButtons") }) }) : ($(".js-CompetitionPage").html($returned), $(".ContentBlock").hide(), $(".js-CompetitionSuccessful").show(), $(window).trigger("checkScrollboxSize"), $(window).trigger("bindCompetitionForm")) } }), !1 }, debug: !0 }) }; $(window).on("bindCompetitionForm", a) }(), function () { var a = function () { $(window).trigger("linkLikeButtons"), $(".js-showEcardForm").click(function () { b() }), $("#form_message").textareaCount({ maxCharacterSize: 140, originalStyle: "originalDisplayInfo", warningStyle: "is-warning", warningNumber: 0, displayFormat: "#left" }), $(".js-XmasCardForm").each(function () { var a = $(this), b = $(".Button", a); b.click(function () { a.validate({ rules: { "form[name]": { required: !0 }, "form[friends_name]": { required: !0 }, "form[message]": { required: !0, maxlength: 140 } }, messages: { "form[name]": { required: "Your name is required" }, "form[friends_name]": { required: "Your friend's name is required" }, "form[message]": { required: "A Message is required", maxlength: "Your message can't be longer than 140 characters" } }, highlight: function (a) { $(a).closest(".Control").addClass("is-invalid") }, unhighlight: function (a) { $(a).closest(".Control").removeClass("is-invalid") }, errorPlacement: function () { }, submitHandler: function () { var a = $("#base_url").val(), b = $("#form_name").val(), d = $("#form_friends_name").val(), e = $("#form_card").val(), f = $("#form_message").val(), g = a + "/img/ecards/" + e + ".jpg", h = b + " is sending you some Christmas cheer!", i = "Tell someone youâ€™re thinking of them and hey, drop a not so subtle hint about what you want for Christmas by sharing a Jack Daniel's card today", j = "http://www.facebook.com/sharer/sharer.php?s=100"; return j += "&p[url]=" + encodeURIComponent(a + "?destination=ecard&n=" + b + "&fn=" + d + "&cid=" + e + "&msg=" + f), j += "&p[images][0]=" + encodeURIComponent(g), j += "&p[title]=" + encodeURIComponent(h), j += "&p[summary]=" + encodeURIComponent(i), window.open(j, "_blank", "location=yes,height=330,width=550,scrollbars=yes,status=no"), c(), !1 } }) }) }) }, b = function () { $(".js-ecardSent").fadeOut(300, function () { $(".js-ecardForm").fadeIn(300), $(".js-XmasCardForm")[0].reset(); var a = $(".js-XmasCardForm .Button"); a.removeClass("is-disabled"), a.data("disabled", !1), a.val("Send Card"), $(window).trigger("checkScrollboxSize") }) }, c = function () { $(".js-ecardForm").fadeOut(300, function () { $(".js-ecardSent").fadeIn(300), $(window).trigger("checkScrollboxSize") }) }; $(window).on("bindCardForm", a) }(), function () { var a, b = document.createElement("video"), c = $('<div class="ProgressBar"><div class="ProgressBar-meterLabel">0</div></div>').appendTo("body"), d = $(".ProgressBar-meterLabel"), e = !1, f = !1, g = 3488712, h = 11506298, i = 9287617, j = 17631846, k = 0, l = 0, m = 0, n = new jQuery.Deferred, o = new jQuery.Deferred, p = { files: [{ type: "IMAGE", source: "img/preloader-bg.png", size: 74896 }, { type: "IMAGE", source: "img/AgeGate.jpg", size: 82242 }, { type: "IMAGE", source: "img/blank.png", size: 210 }, { type: "IMAGE", source: "img/start.jpg", size: 356191 }, { type: "IMAGE", source: "img/tree.jpg", size: 180714 }, { type: "IMAGE", source: "img/barrelhouse.jpg", size: 164501 }, { type: "IMAGE", source: "img/bbq.jpg", size: 132102 }, { type: "IMAGE", source: "img/distillery.jpg", size: 168675 }, { type: "IMAGE", source: "img/office.jpg", size: 134402 }, { type: "IMAGE", source: "img/competition.jpg", size: 175544 }, { type: "IMAGE", source: "img/barrel-open-failure.png", size: 762907 }, { type: "IMAGE", source: "img/barrel-open-success.png", size: 751329 }, { type: "IMAGE", source: "img/tree/barrel-states.gif", size: 39860 }, { type: "AUDIO", sources: { mp3: { source: "audio/jd-door.mp3", size: 55416 }, ogg: { source: "audio/jd-door.ogg", size: 23955 } } }, { type: "AUDIO", sources: { mp3: { source: "audio/jd-trucks.mp3", size: 48960 }, ogg: { source: "audio/jd-trucks.ogg", size: 65671 } } }, { type: "AUDIO", sources: { mp3: { source: "audio/jd-ambience.mp3", size: 663840 }, ogg: { source: "audio/jd-ambience.ogg", size: 848055 } } }] }, q = function () { if (b && b.buffered && b.buffered.length > 0 && b.buffered.end && b.duration) { var a = b.buffered.end(0), c = b.duration; l = a.toFixed(2) / c.toFixed(2) * 100, l >= 100 && !e && (n.resolve(), e = !0, b.removeEventListener("loaded", q), b.removeEventListener("progress", q), b.removeEventListener("canplaythrough", q)), u() } }, r = function () { setTimeout(function () { $(".ProgressBar").remove(), b.defaultPlaybackRate = 1, b.playbackRate = 1, b.currentTime = 0, b.pause(), $(window).trigger("initialiseAudio"), $(window).trigger("videoLoaded") }, 700) }, s = function () { document.getElementById("background"); b.setAttribute("id", "transitionVideo"), b.setAttribute("preload", "auto"), b.setAttribute("autobuffer", "true"), b.setAttribute("autoplay", "true"), b.setAttribute("width", "1920"), b.setAttribute("height", "1200"), $("html").hasClass("lt-ie10") === !0 ? (b.addEventListener("ended", r, !1), d.text("")) : (b.addEventListener("loaded", q, !1), b.addEventListener("progress", q, !1), b.addEventListener("canplaythrough", q, !1)), f && (b.playbackRate = 5, b.defaultPlaybackRate = 5), b.setAttribute("src", a), $(b).insertBefore("#bgImage") }, t = function () { v(), c.addClass("is-loading"), $("html").hasClass("lt-ie10") === !0 ? d.addClass("is-ie9") : d.addClass("is-not-ie9"), $.html5Loader({ filesToLoad: p, onComplete: function () { o.resolve() }, onUpdate: function (a) { m = a, u() } }) }, u = function () { var a = g + k, b = g * (m / 100), c = k * (l / 100), e = b + c, f = Math.round(e / a * 100); $("html").hasClass("lt-ie10") === !1 && d.text(f) }, v = function () { var c, d, e, g; b.canPlayType && (c = "" !== b.canPlayType('video/mp4; codecs="mp4video.20.8"'), d = "" !== (b.canPlayType('video/mp4; codecs="avc1.42E01E"') || b.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')), e = "" !== b.canPlayType('video/ogg; codecs="theora"'), g = "" !== b.canPlayType('video/webm; codecs="vp8, vorbis"')), $("html").hasClass("lt-ie10") === !0 ? (a = "video/ie9.mp4", f = !0, k = i) : c || d ? (a = "video/ie9.mp4", f = !0, k = h) : (a = "video/transitions.webm", k = j) }; $.when(n, o).done(function () { r() }), $(window).on("loadRequiredAssets", function () { t(), s() }) }(), function () { var a, b, c, d, e, f = $("#bgImage"), g = $(".homeOverlay"), h = "start", i = 2.35, j = !1, k = !1, l = { home: { image: "start.jpg", inpoint: 0, duration: 2.35 }, "barrel-house": { image: "barrelhouse.jpg", inpoint: 2.36, duration: 3 }, "bbq-hill": { image: "bbq.jpg", inpoint: 8.36, duration: 4.16 }, distillery: { image: "distillery.jpg", inpoint: 16.7, duration: 2.36 }, "jacks-office": { image: "office.jpg", inpoint: 21.43, duration: 3.33 }, "barrel-tree": { image: "tree.jpg", inpoint: 28.1, duration: 2.33 } }, m = { home: { background: l.home, ajaxEndpoint: "home", loadedAjax: null }, "barrel-tree": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree", loadedAjax: null }, "xmas-promo": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree/promo", loadedAjax: null }, "barrel-tree-competition": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree/competition", loadedAjax: null }, "barrel-tree-competition-terms": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree/competition/terms", loadedAjax: null }, "xmas-ecards": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree/e-cards", loadedAjax: null }, "xmas-ecards-share": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree/e-cards", loadedAjax: null }, "holiday-select": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree/holiday", loadedAjax: null }, "pack-promo": { background: l["barrel-tree"], ajaxEndpoint: "barrel-tree/promo", loadedAjax: null }, "bbq-hill": { background: l["bbq-hill"], ajaxEndpoint: "bbq-hill", loadedAjax: null }, "jacks-office": { background: l["jacks-office"], ajaxEndpoint: "jacks-office", loadedAjax: null }, distillery: { background: l.distillery, ajaxEndpoint: "distillery", loadedAjax: null }, "barrel-house": { background: l["barrel-house"], ajaxEndpoint: "barrel-house", loadedAjax: null } }, n = function () { $(".PrimaryNavigation-navlist").fadeOut(), $(".js-togglePrimaryNavigation").fadeIn() }, o = function () { $(".js-togglePrimaryNavigation").fadeOut(), $(".PrimaryNavigation-navlist").fadeIn() }, p = function () { a.currentTime >= i && (clearInterval(b), j ? (s(c, "in", !0), j = !1) : q()) }, q = function () { a.pause(), "home" == h ? (g.show(), $(window).trigger("playSound"), imgSrc = "img/start.jpg") : imgSrc = "img/" + m[h].background.image, f.attr("src", imgSrc), $(window).trigger("matchSize"), setTimeout(function () { f.fadeTo(300, 1, function () { $(".PrimaryNavigation").fadeIn(300), "home" != h && (r(0), $(".js-PageContent").fadeIn(300)) }) }, 300), k = !0 }, r = function (a) { var b = m[h]; b.loadedAjax ? ($(window).off("ajaxFinishedLoading", r), $(".js-loadedContent").html(m[h].loadedAjax), $(window).trigger("contentloaded"), $("#scrollingContent").fadeIn(a), "barrel-tree-competition" == h ? $(window).trigger("initialiseBarrelPromo") : "xmas-ecards" == h && $(window).trigger("initialiseXmasCards"), setTimeout(function () { $(window).trigger("contentloaded"), $(window).trigger("linkLikeButtons") }, a + 400)) : $(window).on("ajaxFinishedLoading", { fadeDuration: 500 }, r) }, s = function (c, d, e) { clearInterval(b), currentFrame = m[c].background, "in" == d ? (startPoint = currentFrame.inpoint, i = currentFrame.inpoint + currentFrame.duration) : (startPoint = currentFrame.inpoint + currentFrame.duration, i = currentFrame.inpoint + 2 * currentFrame.duration), a.pause(), a.currentTime = startPoint, e ? (a.play(), b = setInterval(p, 30)) : f.fadeTo(300, 0, function () { a.play(), b = setInterval(p, 30) }) }, t = function (a) { var b = m[a]; $(window).off("ajaxFinishedLoading", r), b.loadedAjax || (e = $.ajax({ url: b.ajaxEndpoint, success: function (a) { b.loadedAjax = a, $(window).trigger("ajaxFinishedLoading") } })) }, u = function (a) { c = "" != a && a in m ? a : "home", "barrel-tree-competition" != c && $(window).trigger("hideBarrelPromo"), $("#scrollingContent").find("iframe").attr("src", ""), "start" == h ? "home" == c ? ($(window).trigger("playHomepageSound"), s("home", "in")) : (g.hide(), j = !0, s("home", "in", !0), t(c)) : (g.hide(), $(window).trigger("stopSound"), m[c].background != m[h].background ? (k = !1, $(".PrimaryNavigation, .js-PageContent").fadeOut(300), "home" == c ? s(h, "out") : (t(c), "home" == h ? s(c, "in") : (j = !0, s(h, "out")))) : (k = !0, t(c), $("#scrollingContent").fadeOut(300, function () { m[c].loadedAjax ? r() : (t(c), $(window).on("ajaxFinishedLoading", r)) }))), h = c, $(".Navigation-item").removeClass("is-active"), $('.Navigation-item[href="#' + h + '"]').addClass("is-active") }, v = function () { a = document.getElementById("transitionVideo"), $(window).on("hashchange", function (a) { a.preventDefault(); var b = location.hash.substr(1); u(b), $(window).trigger("hideBarrelPromo") }), $(window).on("hideNavigation", n), $(window).on("showNavigation", o), $('a[href^="#"], #background a').click(function (a) { if (k) { a.preventDefault(), n(); var b = $(this).attr("href").substr(1); location.hash = b } else a.preventDefault(), a.stopPropagation() }), $(".PrimaryNavigation-navlist").mouseenter(function () { clearTimeout(d) }), $(".PrimaryNavigation-navlist").mouseleave(function () { d = setTimeout(n, 1e4) }), $(".js-closeNavigation").click(function () { n() }), $(".js-togglePrimaryNavigation").click(function (a) { a.preventDefault(), o() }), f.fadeTo(800, 0), setTimeout(function () { var a = location.hash.substr(1); u(a), $(window).trigger("showNavigation"), d = setTimeout(n, 1e4) }, 1e3), $("#footer").removeClass("is-hidden"), $(".js-soundToggle").fadeIn() }; $(window).on("videoLoaded", v) }(), function () { var a, b = 32, c = [], d = 0, e = 5, f = function () { for (n(), clearTimeout(a), $(".overlay").removeClass("active") ; c.length < 5;) { for (var e = Math.ceil(Math.random() * b), f = !1, h = 0; h < c.length; h++) if (c[h] == e) { f = !0; break } f || (c[c.length] = e) } d = c[2]; for (var i = 0; i < c.length; i++) $('.overlay[data-barrelnumber="' + c[i] + '"]').addClass("active"); clearTimeout(a), a = setTimeout(g, 3500), o(), $(".js-CompetitionGuessCount").fadeIn(300), $(".BarrelTreeOverlay").show(), $(".js-showCompetition").fadeOut() }, g = function () { $(".overlay").removeClass("active"), h() }, h = function () { $(".BarrelTreeOverlay area").on("mouseenter", j), $(".BarrelTreeOverlay area").on("mouseleave", k), $(".BarrelTreeOverlay area").on("click", l) }, i = function () { $(".BarrelTreeOverlay area").off("mouseenter", j), $(".BarrelTreeOverlay area").off("mouseleave", k), $(".BarrelTreeOverlay area").off("click", l) }, j = function () { var a = $(this).data("barrelnumber"); $('.highlight[data-barrelnumber="' + a + '"]').addClass("active") }, k = function () { var a = $(this).data("barrelnumber"); $('.highlight[data-barrelnumber="' + a + '"]').removeClass("active") }, l = function (a) { a.preventDefault(); var b = $(this).data("barrelnumber"); $('.highlight[data-barrelnumber="' + b + '"]').addClass("active"), $('.overlay[data-barrelnumber="' + b + '"]').removeClass("active"), $(this).off("mouseenter", j), $(this).off("mouseleave", k), $(this).off("click", l), m(b) }, m = function (a) { e--, a == d ? ($("#CompetitionImage").fadeIn(300), $(".js-CompetitionWelcome").fadeOut(300, function () { $(".js-CompetitionSuccessful").fadeIn(300, function () { $(window).trigger("contentloaded") }) }), $(".BarrelTreeOverlay").hide(), $(".js-BarrelOpenSuccess").fadeIn(600, function () { $(window).trigger("playDoorOpenSound"), $(this).addClass("playAnimation") }), $(window).trigger("bindCompetitionForm"), $(".js-CompetitionGuessCount").fadeOut()) : 0 === e ? ($(".BarrelTreeOverlay").hide(), $("#CompetitionImage").fadeIn(300), $(".js-CompetitionWelcome").fadeOut(300, function () { $(".js-CompetitionUnsuccessful").fadeIn(300, function () { $(window).trigger("contentloaded") }) }), $(".js-BarrelOpenFailure").fadeIn(600, function () { $(window).trigger("playDoorOpenSound"), $(this).addClass("playAnimation") }), $(".js-CompetitionGuessCount").fadeOut(300, function () { o() })) : o(), $("#scrollingContent").tinyscrollbar_update() }, n = function () { c = [], e = 5, i(), $(".BarrelTreeOverlay").hide(), $(".BarrelTreeOverlay .highlight").removeClass("active"), $(".BarrelTreeOverlay .overlay").removeClass("active"), $(".js-BarrelOpenSuccess, .js-BarrelOpenFailure").fadeOut().removeClass("playAnimation"), $("#CompetitionImage").fadeOut(), $(".js-CompetitionGuessCount").fadeOut() }, o = function () { offset = -101 * (6 - e) - 1, $(".CompetitionGuessCount-remainingCount").css("backgroundPosition", "0 " + offset + "px") }, p = function () { $("#CompetitionImage").fadeOut(), $(".js-BarrelOpenSuccess, .js-BarrelOpenFailure").fadeOut().removeClass("playAnimation"), $(".js-CompetitionUnsuccessful, .js-CompetitionSuccessful").fadeOut(300, function () { $(".js-CompetitionWelcome").fadeIn(300, function () { $(window).trigger("contentloaded") }) }), f() }; $(window).on("initialiseBarrelPromo", function () { $(".js-showCompetition").click(function () { $(".PrimaryNavigation-navlist").hide(), $(".js-togglePrimaryNavigation").show(), f() }), $(".js-restartCompetition").click(function () { p() }) }), $(window).on("hideBarrelPromo", n) }(), function () { var a, b, c, d = function () { newIndex = 0 === b ? a : b - 1, f(newIndex) }, e = function () { newIndex = b === a ? 0 : b + 1, f(newIndex) }, f = function (a) { $(".Modal-Content").each(function () { var c = $(this); $oldSlide = c.children().eq(b), $newSlide = c.children().eq(a), $oldSlide.css("z-index", "2"), $newSlide.hide().css("z-index", "3"), $newSlide.fadeIn(200, function () { c.children().not(":eq(" + b + ")").css("z-index", "1") }) }), b = a, $(".js-ModalPosition").text(b + 1), $("#form_card").val("card" + (b + 1)).change() }, g = function (d) { d.preventDefault(), c = $(".Modal-Content"), a = c.children().length - 1, $("#form_card").val("card1").change(), b = a, h(), $(window).trigger("bindCardForm"), clone = $(".js-xmasCardModal").clone(!0), clone.find(".js-fancyBoxEcardtrigger").remove(), clone.find(".Modal-ContentImage").each(function () { var a = $(this), b = a.attr("data-modalsrc"); a.attr("src", b) }), $(".js-fancyBoxEcardtrigger").fancybox({ type: "inline", content: clone, fitToView: !0, aspectRatio: !0, maxWudth: 1200, scrolling: "no", margin: 30, padding: 10, beforeShow: function () { f(b), h(), $.fancybox.reposition(), $.fancybox.update() } }), $(".js-showEcardForm").click(function () { $(".js-ecardForm").removeClass("isHidden"), $(".js-ecardSent").addClass("isHidden"), $("#scrollingContent").tinyscrollbar_update() }), f(0) }, h = function () { $(".js-carouselPrev").off("click", d), $(".js-carouselNext").off("click", e), $(".js-carouselPrev").on("click", d), $(".js-carouselNext").on("click", e) }; $(window).on("initialiseXmasCards", g) }(), function () { for (var a, b = function () { }, c = ["assert", "clear", "count", "debug", "dir", "dirxml", "error", "exception", "group", "groupCollapsed", "groupEnd", "info", "log", "markTimeline", "profile", "profileEnd", "table", "time", "timeEnd", "timeStamp", "trace", "warn"], d = c.length, e = window.console = window.console || {}; d--;) a = c[d], e[a] || (e[a] = b) }(), function () { var a = $(".scalableLayer"), b = function () { var b = 1.6, c = Math.max($(window).width(), 990) / Math.max($(window).height(), 680), d = c > b ? "landscape" : "portrait", e = "landscape" != d ? $(window).height() / 1200 : $(window).width() / 1920; marginLeft = "portrait" == d ? (1920 * e / 1.3 - $(window).width() / 1.3) * -(b - c) : 0, a.css({ "-moz-transform": "scale(" + e + ", " + e + ")", "-webkit-transform": "scale(" + e + ", " + e + ")", "-o-transform": "scale(" + e + ", " + e + ")", transform: "scale(" + e + ", " + e + ")", "margin-left": marginLeft }) }, c = function () { b(), d() }, d = function () { var a; $(".PageContent .js-ContentWrapper").height(Math.max($(window).height(), 680) - 160), $("#scrollingContent .viewport").height($(".PageContent .js-ContentWrapper").height()), a = $("#scrollingContent .overview").height() < $("#scrollingContent").height() ? $(".PageContent").width() - 60 : $(".PageContent").width() - 80, $("#scrollingContent .viewport").width(a), $("#scrollingContent").tinyscrollbar_update() }; $(window).resize(function () { c() }), $("a[rel=external]").click(function () { $(this).attr("target", "blank") }), $(".js-PanelFooter-enjoy").mouseenter(function () { $(".PanelFooter-legal").removeClass("is-hidden") }), $(".PanelFooter").mouseleave(function () { $(".PanelFooter-legal").addClass("is-hidden") }), $(window).on("contentloaded", function () { d() }), $("#scrollingContent").tinyscrollbar({ axis: "y" }), c(), $("#bgImage").fadeTo(500, 1, function () { $(window).trigger("loadRequiredAssets"), $(window).trigger("initialiseSnow") }), $(window).on("checkScrollboxSize", d), $(window).on("matchSize", b), $(window).on("linkLikeButtons", function () { FB.XFBML.parse(document.getElementById("scrollingContent")) }) }();
//# sourceMappingURL=/js/build/desktop.min.hash-b8d9e17f.js.map